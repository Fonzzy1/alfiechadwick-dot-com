<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta
  name="author"
  content="Alfie Chadwick"
/>
<meta
  name="description"
  content="Like most developers, I spend an inordinate amount of time dealing with my local installations and dependencies. When working on multiple projects, it is not uncommon to encounter conflicting versions of dependencies, and while virtual environments and package managers like Node Package Manager help to mitigate this issue, they often fall short.
Why we use Dev-Containers A common solution to these issues is the use of &amp;lsquo;dev-containers&amp;rsquo;, which have mostly been popularized by VS Code as a way to have your dependencies exist exclusively inside a Docker container, and then attach an editor to it to make your changes."
/>
<meta
  name="keywords"
  content=", Devops, Docker, Vim"
/>
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/2024/01/07/diy-dev-containers/" />

<title>
   DIY Dev-Containers :: Alfie Chadwick  
</title>


 
<link
  rel="stylesheet"
  href="/main.a9ab624e85e095bcf95bb267aad409c118b491d4ab8297e6d81ced1812528418.css"
  integrity="sha256-qatiToXglbz5W7JnqtQJwRi0kdSrgpfm2BztGBJShBg="
/>



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">
 <meta itemprop="name" content="DIY Dev-Containers">
<meta itemprop="description" content="Like most developers, I spend an inordinate amount of time dealing with my local installations and dependencies. When working on multiple projects, it is not uncommon to encounter conflicting versions of dependencies, and while virtual environments and package managers like Node Package Manager help to mitigate this issue, they often fall short.
Why we use Dev-Containers A common solution to these issues is the use of &lsquo;dev-containers&rsquo;, which have mostly been popularized by VS Code as a way to have your dependencies exist exclusively inside a Docker container, and then attach an editor to it to make your changes."><meta itemprop="datePublished" content="2024-01-07T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-01-07T00:00:00+00:00" />
<meta itemprop="wordCount" content="1617">
<meta itemprop="keywords" content="Devops,Docker,Vim," /> <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DIY Dev-Containers"/>
<meta name="twitter:description" content="Like most developers, I spend an inordinate amount of time dealing with my local installations and dependencies. When working on multiple projects, it is not uncommon to encounter conflicting versions of dependencies, and while virtual environments and package managers like Node Package Manager help to mitigate this issue, they often fall short.
Why we use Dev-Containers A common solution to these issues is the use of &lsquo;dev-containers&rsquo;, which have mostly been popularized by VS Code as a way to have your dependencies exist exclusively inside a Docker container, and then attach an editor to it to make your changes."/>
   
<meta property="article:published_time" content="2024-01-07 00:00:00 &#43;0000 UTC" />










<link  rel='stylesheet' type='text/css' href="//cdn.jsdelivr.net/npm/@catppuccin/highlightjs@0.1.4/css/catppuccin-macchiato.css">
<style>
    pre code.hljs {
        display: block;
        overflow-x: auto;
        padding: 1em;
        background: #1e2030 ;
    }

    code.hljs {
        padding: 3px 5px;
    }
</style>











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#bb9af7;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
  <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/post/">Posts</a></li><li><a href="/tags">Tags</a></li>
  </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
<main class="post">
  <div class="post-info">
    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-clock"
      >
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      8 minutes 
    </p>

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-calendar"
      >
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      
       2024-01-07 

      
      
    </p>
  </div>

  <article>
    <h1 class="post-title">
      <a href="/2024/01/07/diy-dev-containers/">DIY Dev-Containers</a>
    </h1>

      

    <div class="post-content"><p>Like most developers, I spend an inordinate amount of time dealing with my local installations and dependencies. When working on multiple projects, it is not uncommon to encounter conflicting versions of dependencies, and while virtual environments and package managers like Node Package Manager help to mitigate this issue, they often fall short.</p>
<h1 id="why-we-use-dev-containers">Why we use Dev-Containers</h1>
<p>A common solution to these issues is the use of &lsquo;dev-containers&rsquo;, which have mostly been popularized by VS Code as a way to have your dependencies exist exclusively inside a Docker container, and then attach an editor to it to make your changes. Sounds great, but unfortunately for me, I have years of using Vim keybindings built into my muscle memory, so there&rsquo;s little chance of me changing my editor. So instead, I thought, why not just rebuild the dev containers for Vim?</p>
<h1 id="what-i-want">What I want</h1>
<p>So let&rsquo;s quickly scope out this project. In my development containers, I want:</p>
<ul>
<li>Isolated environments</li>
<li>Vim with my configuration built-in</li>
<li>Integration with common CLI tools</li>
<li>The ability to use Docker from inside the container</li>
<li>Secrets management (not having to re-authenticate all my tools every time I open up a container)</li>
<li>Transportability between various Unix machines</li>
</ul>
<h1 id="the-beginnings">The Beginnings</h1>
<p>So after taking a quick look around my system, I have come up with this initial Dockerfile for my development container:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu as setter_upper</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> DEBIAN_FRONTEND<span style="color:#f92672">=</span>noninteractive
<span style="color:#66d9ef">ENV</span> TZ<span style="color:#f92672">=</span>Australia/Melbourne<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Enviroment Installs</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   curl git python3 python3-pip apt-transport-https <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   ca-certificates software-properties-common  libpq-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   build-essential autoconf automake libtool<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#Install Docker</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -fsSL https://get.docker.com -o install-docker.sh<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> sh install-docker.sh<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install GH CLI</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of<span style="color:#f92672">=</span>/usr/share/keyrings/githubcli-archive-keyring.gpg <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#f92672">&amp;&amp;</span> chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;deb [arch=</span><span style="color:#66d9ef">$(</span>dpkg --print-architecture<span style="color:#66d9ef">)</span><span style="color:#e6db74"> signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main&#34;</span> | tee /etc/apt/sources.list.d/github-cli.list &gt; /dev/null <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#f92672">&amp;&amp;</span> apt update <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#f92672">&amp;&amp;</span> apt install gh -y<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># git</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#RUN gh auth setup-git</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">run</span> git config --global user.name <span style="color:#e6db74">&#34;Fonzzy1&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">run</span> git config --global user.email <span style="color:#e6db74">&#34;alfiechadwick@hotmail.com&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Set the base work dir</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /src</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Set the mount point as the safe dir</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> git config --global --add safe.directory /src<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Vim Setup</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> setter_upper as vim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Enviroment Installs</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y software-properties-common<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> add-apt-repository ppa:jonathonf/vim<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install the rest of the dependencies</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get install -y <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    tig <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    fzf <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pkg-config <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    texlive <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    r-base <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pandoc <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    texlive-latex-extra <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libcurl4-openssl-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libssl-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libxml2-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libfontconfig1-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libharfbuzz-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libfribidi-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libfreetype6-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libpng-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libtiff5-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libjpeg-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    r-cran-tidyverse <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    vim-gtk3<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#Install Ctags</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -L https://github.com/thombashi/universal-ctags-installer/raw/master/universal_ctags_installer.sh | bash<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install node</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> set -uex<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p /etc/apt/keyrings<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> echo <span style="color:#e6db74">&#34;deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_20.x nodistro main&#34;</span> |  tee /etc/apt/sources.list.d/nodesource.list<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install nodejs -y;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install the python packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pip install black pipreqs pgcli awscli socli<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install npm packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install --save-dev --global prettier<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Download and Install Vim-Plug</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -fLo /root/.vim/autoload/plug.vim --create-dirs <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install ACT extention</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p /root/.local/share/gh/extensions/gh-act<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> curl -L -o /root/.local/share/gh/extensions/gh-act/gh-act <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#e6db74">&#34;https://github.com/nektos/gh-act/releases/download/v0.2.57/linux-amd64&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod +x /root/.local/share/gh/extensions/gh-act/gh-act<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install R packages, tidyvverse is installed with apt</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;rmarkdown&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;reticulate&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;blogdown&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;blogdown::install_hugo()&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;readxl&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;knitr&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;tinytex&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> R -e  <span style="color:#e6db74">&#34;install.packages(&#39;languageserver&#39;,  Ncpus = 6)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Bring in the vim config</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> vim /root/.vim<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#Copy in the dotfiles</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> dotfiles /root<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install Vim Plugins</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> vim +PlugInstall +qall<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install COC plugins</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p /root/.config/coc/extensions <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    echo <span style="color:#e6db74">&#39;{&#34;dependencies&#34;:{}}&#39;</span> &gt; /root/.config/coc/extensions/package.json <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    grep <span style="color:#e6db74">&#39;let g:coc_global_extensions&#39;</span> /root/.vim/config/coc.vim | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    sed <span style="color:#e6db74">&#34;s/.*\[//; s/\].*//; s/&#39;//g; s/, /\n/g&#34;</span> | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#66d9ef">while</span> read -r extension; <span style="color:#66d9ef">do</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        echo <span style="color:#e6db74">&#34;Installing coc extension: </span>$extension<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        cd /root/.config/coc/extensions <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        npm install <span style="color:#e6db74">&#34;</span>$extension<span style="color:#e6db74">&#34;</span> --install-strategy<span style="color:#f92672">=</span>shallow --save; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#66d9ef">done</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> vim<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>I won&rsquo;t bother explaining most of it since it&rsquo;s really just a heap of install statements, but here are some of the interesting parts:</p>
<ul>
<li>I needed to add the WORKDIR to the list of safe directories for git since if I mount the file, the ownership will be wrong.</li>
<li>I needed to manually install the gh act extension as you can&rsquo;t do it normally without authenticating with a gh token, something I don&rsquo;t want to do in a public container.</li>
<li>Coc Extensions needed to be manually installed to prevent them from installing every time I started the container. Just calling <code>Vim +CocInstall</code> didn&rsquo;t work because it&rsquo;s an async process.</li>
</ul>
<p>So at this point, I have the first three of my requirements done. Because I&rsquo;m using Docker, I have an isolated environment every time I boot up the container. By copying over my Vim config files, I have my Vim config baked in, and with some of the commands in the Dockerfile, I am able to have it set up. Finally, by installing a heap of CLI tools, I am able to do most of my work from inside the Vim terminal.</p>
<h1 id="docker-in-docker">Docker In Docker</h1>
<p>The next thing to tick off the list is being able to run Docker commands from within the container. Although I have installed Docker, running any Docker command inside the container will say the daemon isn&rsquo;t running.</p>
<p>I could put in a lot of work to give the container the ability to create its own containers, but that would be a real pain. Instead, I can simply mount the Docker daemon onto the container, so that running Docker commands inside the container will invoke the system Docker.</p>
<p>To accomplish this, I can execute the container using the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -it -v /var/run/docker.sock:/var/run/docker.sock fonzzy1/vim
</code></pre></div><h1 id="secrets-management">Secrets Management</h1>
<p>The next thing to implement is secrets management. I currently have all of these stored in config files in my home directory, which isn&rsquo;t best practice in a Docker container that I want to make public. Instead, I can put all my secrets in a .env file and reference them in the Docker container. This can be done using the &ndash;env-file flag when running my Docker container.</p>
<h1 id="portability">Portability</h1>
<p>The final goal on my list is to make the container portable between my multiple machines. This is achieved through the use of Docker Hub, which will allow me to download the image from Docker Hub. The only other thing I need is to ensure that Docker is set up on the other machine. For this, I have written a quick script to handle the setup process.</p>
<p>```{bash, eval=FALSE}
#!/bin/bash
set -e</p>
<h1 id="dot-progress-indicator">Dot Progress Indicator</h1>
<p>progress() {
local pid=$2 # PID of the process we&rsquo;re waiting for
local text=$1
local delay=2 # 2-second delay between dots
local dot=&quot;.&quot;</p>
<pre><code>printf &quot;%s:&quot; &quot;$text&quot;
while [ &quot;$(ps a | awk '{print $1}' | grep -w $pid)&quot; ]; do
    printf &quot;%s&quot; &quot;$dot&quot;
    sleep $delay
done
printf &quot; Done!\n&quot;
</code></pre>
<p>}</p>
<p>progress &ldquo;Updating package list&rdquo; $(sudo apt-get update &gt; /dev/null 2&gt;&amp;1 &amp; echo $!)</p>
<p>progress &ldquo;Installing Useful Packages&rdquo; $(sudo apt-get install -y curl &gt; /dev/null 2&gt;&amp;1 &amp; echo $!)</p>
<p>progress &ldquo;Fetching Docker Install Script&rdquo; $(curl -fsSL <a href="https://get.docker.com">https://get.docker.com</a> -o install-docker.sh &gt; /dev/null 2&gt;&amp;1 &amp; echo $!)</p>
<p>progress &ldquo;Installing Docker&rdquo; $(sudo sh install-docker.sh &gt; /dev/null 2&gt;&amp;1 &amp; echo $!)</p>
<p>progress &ldquo;Adding the current user to the Docker group&rdquo; $(sudo usermod -aG docker $USER &gt; /dev/null 2&gt;&amp;1 &amp; echo $!)</p>
<p>progress &ldquo;Pulling Image&rdquo; docker pull fonzzy1/vim</p>
<p>echo &ldquo;Setup complete!&rdquo;</p>
<pre><code># Wrapping it up

My so now I have my dev containers running, my only gripe is the stupidly long docker commands that I need to type out to get it running, such as:



```{bash, eval=FALSE}
current_dir=&quot;$(pwd)&quot;
dir_name=&quot;$(basename &quot;$current_dir&quot;)&quot;

docker run -it \
  --env-file ~/.env \
  --net=host \
  --rm \
  -v &quot;$current_dir:/$(dir_name)&quot; \
  -w &quot;/$dir_name&quot; \
  -v /var/run/docker.sock:/var/run/docker.sock \
  fonzzy1/vim \
  /bin/bash -c &quot;gh auth setup-git; git config --global --add safe.directory /$dir_name; vim&quot;
</code></pre>
<p>So I decided to make this into a little Python script that allows me to quickly run these commands. I also added an integration with <code>gh</code> that lets me clone repos in order to edit them on the fly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/bin/python3</span>
<span style="color:#f92672">import</span> subprocess
<span style="color:#f92672">import</span> argparse
<span style="color:#f92672">import</span> os


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_local</span>(args):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Runs a command in a Docker container with the current directory mounted.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Args:
</span><span style="color:#e6db74">        args (argparse.Namespace): The command-line arguments.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Returns:
</span><span style="color:#e6db74">        None
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    current_dir <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>run([<span style="color:#e6db74">&#34;pwd&#34;</span>], capture_output<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, text<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>strip()
    dir_name <span style="color:#f92672">=</span> current_dir<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]  <span style="color:#75715e"># Get the name of the current directory</span>

    subprocess<span style="color:#f92672">.</span>run(
        [
            <span style="color:#e6db74">&#34;docker&#34;</span>,
            <span style="color:#e6db74">&#34;run&#34;</span>,
            <span style="color:#e6db74">&#34;-it&#34;</span>,
            <span style="color:#e6db74">&#34;--env-file&#34;</span>,
            os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#34;~/.env&#34;</span>),
            <span style="color:#e6db74">&#34;--net=host&#34;</span>,
            <span style="color:#e6db74">&#34;--rm&#34;</span>,
            <span style="color:#e6db74">&#34;-v&#34;</span>,
            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>current_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">:/</span><span style="color:#e6db74">{</span>dir_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,  <span style="color:#75715e"># Mount to a directory with the same name</span>
            <span style="color:#e6db74">&#34;-w&#34;</span>,
            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/</span><span style="color:#e6db74">{</span>dir_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,  <span style="color:#75715e"># Set the working directory</span>
            <span style="color:#e6db74">&#34;-v&#34;</span>,
            <span style="color:#e6db74">&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>,
            <span style="color:#e6db74">&#34;fonzzy1/vim&#34;</span>,
            <span style="color:#e6db74">&#34;/bin/bash&#34;</span>,
            <span style="color:#e6db74">&#34;-c&#34;</span>,
            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;gh auth setup-git; git config --global --add safe.directory /</span><span style="color:#e6db74">{</span>dir_name<span style="color:#e6db74">}</span><span style="color:#e6db74">; vim&#34;</span>,
        ]
    )


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_gh</span>(args):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Runs a command for cloning a GitHub repository in a Docker container.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Args:
</span><span style="color:#e6db74">        args (argparse.Namespace): The command-line arguments.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Returns:
</span><span style="color:#e6db74">        None
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    name <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>repo<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;-&#34;</span>)
    repo <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>repo<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">in</span> args<span style="color:#f92672">.</span>repo <span style="color:#66d9ef">else</span> args<span style="color:#f92672">.</span>repo
    command <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;gh auth setup-git; gh repo clone </span><span style="color:#e6db74">{</span>args<span style="color:#f92672">.</span>repo<span style="color:#e6db74">}</span><span style="color:#e6db74"> /</span><span style="color:#e6db74">{</span>repo<span style="color:#e6db74">}</span><span style="color:#e6db74">; &#34;</span>

    <span style="color:#75715e"># Additional git command based on input parameters</span>
    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>branch:
        command <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;git switch </span><span style="color:#e6db74">{</span>args<span style="color:#f92672">.</span>branch<span style="color:#e6db74">}</span><span style="color:#e6db74">; &#34;</span>
    <span style="color:#66d9ef">elif</span> args<span style="color:#f92672">.</span>pullrequest:
        command <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;gh pr checkout </span><span style="color:#e6db74">{</span>args<span style="color:#f92672">.</span>pullrequest<span style="color:#e6db74">}</span><span style="color:#e6db74">; &#34;</span>
    <span style="color:#66d9ef">elif</span> args<span style="color:#f92672">.</span>checkout:
        command <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;git checkout -b </span><span style="color:#e6db74">{</span>args<span style="color:#f92672">.</span>checkout<span style="color:#e6db74">}</span><span style="color:#e6db74">; git push --set-upstream origin </span><span style="color:#e6db74">{</span>args<span style="color:#f92672">.</span>checkout<span style="color:#e6db74">}</span><span style="color:#e6db74">; &#34;</span>

    <span style="color:#75715e"># Update submodules if any</span>
    command <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;git submodule update --init; vim; &#34;</span>

    <span style="color:#75715e"># Check for unpushed or uncommitted changes before exiting Vim</span>
    check_changes_command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; </span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">        CHANGES=$(git status --porcelain); </span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">        UPSTREAM_CHANGES=$(git cherry -v); </span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">        if [ -n &#34;$CHANGES&#34; ] || [ -n &#34;$UPSTREAM_CHANGES&#34; ]; then </span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">            vim -c </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">:G | only</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">; </span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">        fi&#39;</span>

    <span style="color:#75715e"># Final combined command</span>
    final_command <span style="color:#f92672">=</span> command <span style="color:#f92672">+</span> check_changes_command

    subprocess<span style="color:#f92672">.</span>run(
        [
            <span style="color:#e6db74">&#34;docker&#34;</span>,
            <span style="color:#e6db74">&#34;run&#34;</span>,
            <span style="color:#e6db74">&#34;-it&#34;</span>,
            <span style="color:#e6db74">&#34;--env-file&#34;</span>,
            os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#34;~/.env&#34;</span>),
            <span style="color:#e6db74">&#34;--name&#34;</span>,
            name,
            <span style="color:#e6db74">&#34;--net=host&#34;</span>,
            <span style="color:#e6db74">&#34;--rm&#34;</span>,
            <span style="color:#e6db74">&#34;-w&#34;</span>,
            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/</span><span style="color:#e6db74">{</span>repo<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
            <span style="color:#e6db74">&#34;-v&#34;</span>,
            <span style="color:#e6db74">&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span>,
            <span style="color:#e6db74">&#34;fonzzy1/vim&#34;</span>,
            <span style="color:#e6db74">&#34;/bin/bash&#34;</span>,
            <span style="color:#e6db74">&#34;-c&#34;</span>,
            final_command,
        ]
    )


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
    subparsers <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>add_subparsers(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;commands&#34;</span>, dest<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;command&#34;</span>)

    local_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(
        <span style="color:#e6db74">&#34;local&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Run command for a container with local directory&#34;</span>
    )
    local_parser<span style="color:#f92672">.</span>set_defaults(func<span style="color:#f92672">=</span>run_local)

    gh_parser <span style="color:#f92672">=</span> subparsers<span style="color:#f92672">.</span>add_parser(<span style="color:#e6db74">&#34;gh&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Run command for cloning a repo&#34;</span>)
    gh_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;repo&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Specify the repository for cloning&#34;</span>)
    gh_parser<span style="color:#f92672">.</span>set_defaults(func<span style="color:#f92672">=</span>run_gh)
    gh_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-b&#34;</span>, <span style="color:#e6db74">&#34;--branch&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;The branch to checkout&#34;</span>)
    gh_parser<span style="color:#f92672">.</span>add_argument(
        <span style="color:#e6db74">&#34;-p&#34;</span>, <span style="color:#e6db74">&#34;--pullrequest&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;The pull request number to checkout&#34;</span>
    )
    gh_parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;--checkout&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Checkout a new branch from main&#34;</span>)

    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
    args<span style="color:#f92672">.</span>func(args)
</code></pre></div></div>
  </article>

  <hr />

  <div class="post-info">
    
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="/tags/devops/">Devops</a></span>
        <span class="tag"><a href="/tags/docker/">Docker</a></span>
        <span class="tag"><a href="/tags/vim/">Vim</a></span>
        
    </p>
 

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-file-text"
      >
        <path
          d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
        ></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      1617 Words
    </p>
  </div>

  
</main>

            </div>

            
                <footer class="footer">
  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/matlab.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  <script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>





    
    <script src="/js/menu.js"></script>
</footer>

</body>
</html>

            
        </div>

        
    </body>
</html>

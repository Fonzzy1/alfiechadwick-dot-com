<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta
  name="author"
  content="Alfie Chadwick"
/>
<meta
  name="description"
  content="After writing out the last post where I wrote out a python library for using an improved version of Euler&amp;rsquo;s method to solve ODEs. But so far, we haven&amp;rsquo;t been solving ODES, instead we have just been taking an initial value and iterating it over the length of a domain. To To make the ODE estimator work, we need to ensure that the conditions of the ODE are met at each step."
/>
<meta
  name="keywords"
  content=", Calculus, Algebra, Python"
/>
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/2024/01/12/making-my-ode-solver-solve-odes/" />

<title>
   Making my ODE solver solve ODEs :: Alfie Chadwick  
</title>


 
<link
  rel="stylesheet"
  href="/main.a9ab624e85e095bcf95bb267aad409c118b491d4ab8297e6d81ced1812528418.css"
  integrity="sha256-qatiToXglbz5W7JnqtQJwRi0kdSrgpfm2BztGBJShBg="
/>



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">
 <meta itemprop="name" content="Making my ODE solver solve ODEs">
<meta itemprop="description" content="After writing out the last post where I wrote out a python library for using an improved version of Euler&rsquo;s method to solve ODEs. But so far, we haven&rsquo;t been solving ODES, instead we have just been taking an initial value and iterating it over the length of a domain. To To make the ODE estimator work, we need to ensure that the conditions of the ODE are met at each step."><meta itemprop="datePublished" content="2024-01-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-01-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="1179">
<meta itemprop="keywords" content="Calculus,Algebra,Python," /> <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Making my ODE solver solve ODEs"/>
<meta name="twitter:description" content="After writing out the last post where I wrote out a python library for using an improved version of Euler&rsquo;s method to solve ODEs. But so far, we haven&rsquo;t been solving ODES, instead we have just been taking an initial value and iterating it over the length of a domain. To To make the ODE estimator work, we need to ensure that the conditions of the ODE are met at each step."/>
   
<meta property="article:published_time" content="2024-01-12 00:00:00 &#43;0000 UTC" />










<link  rel='stylesheet' type='text/css' href="//cdn.jsdelivr.net/npm/@catppuccin/highlightjs@0.1.4/css/catppuccin-macchiato.css">
<style>
    pre code.hljs {
        display: block;
        overflow-x: auto;
        padding: 1em;
        background: #1e2030 ;
    }

    code.hljs {
        padding: 3px 5px;
    }
</style>











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#bb9af7;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
  <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/post/">Posts</a></li><li><a href="/tags">Tags</a></li>
  </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
<main class="post">
  <div class="post-info">
    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-clock"
      >
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      6 minutes 
    </p>

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-calendar"
      >
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      
       2024-01-12 

      
      
    </p>
  </div>

  <article>
    <h1 class="post-title">
      <a href="/2024/01/12/making-my-ode-solver-solve-odes/">Making my ODE solver solve ODEs</a>
    </h1>

      

    <div class="post-content"><p>After writing out the <a href="../../../2023/12/29/making-a-python-library-to-solve-differential-equations/">last post</a> where I wrote out a python library for using an improved version of Euler&rsquo;s method to solve ODEs. But so far, we haven&rsquo;t been solving ODES, instead we have just been taking an initial value and iterating it over the length of a domain. To To make the ODE estimator work, we need to ensure that the conditions of the ODE are met at each step.</p>
<h1 id="simplifying-odes-constant-linear-odes">Simplifying ODEs: Constant-Linear ODEs</h1>
<p>ODEs are often categorized as linear or non-linear. Linear ODEs take the form <img src="a_0%28x%29y%20%2B%20a_1%28x%29y%27%20%2B%20...%20%2B%20a_n%28x%29y%5E%7Bn%7D%20%3D%20b%28x%29" alt="a_0(x)y + a_1(x)y\' + \... + a_n(x)y^{n} = b(x)" title="a_0(x)y + a_1(x)y' + ... + a_n(x)y^{n} = b(x)">, with both <img src="a" alt="" title="a"> and <img src="b" alt="" title="b"> representing functions of <img src="x" alt="" title="x">, while Non-linear equations are all the others. In our solver&rsquo;s context, we&rsquo;ll concentrate on a subset I&rsquo;ve termed &ldquo;constant-linear&rdquo; ODEs, characterized by constant coefficients for <img src="y" alt="" title="y"> terms and a linear function of <img src="x" alt="" title="x"> for <img src="b" alt="" title="b">. Specifically, a constant-linear ODE looks like <img src="a_0y%20%2B%20a_1y%27%20%2B%20...%20%2B%20a_ny%5E%7Bn%7D%20%3D%20bx%20%2B%20c" alt="a_0y + a_1y\' + \... + a_ny^{n} = bx + c" title="a_0y + a_1y' + ... + a_ny^{n} = bx + c">.<br>
This may seem like a very restrictive requirement, but there are many famous examples of this kind of equation including:</p>
<ol>
<li>
<p>Simple Harmonic Motion:
[ y'' + ^2 y = 0 ]</p>
</li>
<li>
<p>Radioactive Decay:
[ = -y ]</p>
</li>
<li>
<p>RC Circuit Equation:
[ y' + y = 0 ]</p>
</li>
<li>
<p>Damped Harmonic Oscillator:
[ y'' + 2y' + _0^2 y = 0 ]</p>
</li>
<li>
<p>Heat Equation (One-Dimensional):
[ u'' - u'= 0 ]</p>
</li>
<li>
<p>Exponential Growth or Decay:
[ y' = ky ]</p>
</li>
</ol>
<h1 id="a-quick-diversion-odes-in-vector-space">A Quick Diversion: ODEs in Vector Space</h1>
<p>Pivoting for a moment, I want to take a quick moment to reframe how we are imagining ODEs. Most of the time, we see ODEs as curves in space and/or time, but I want to reframe them as planes in a vector space.</p>
<p>Each point in this vector space describes the state of a point along a curve, such that a values of the vector give:</p>
<p><img src="%5Cbegin%7Bbmatrix%7D%0A1%5C%5C%0Ax%5C%5C%0Ay%28x%29%5C%5C%0Ay%27%28x%29%5C%5C%0Ay%27%27%28x%29%5C%5C%0A...%5C%5C%0Ay%5E%7Bn%7D%28x%29%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="\begin{bmatrix}1\\x\\y(x)\\y\'(x)\\y\'\'(x)\\\...\\y^{n}(x)\\\end{bmatrix}" title="\begin{bmatrix}
1\
x\
y(x)\
y'(x)\
y''(x)\
...\
y^{n}(x)\
\end{bmatrix}"></p>
<p>This means that an ODE can be defined by a plane that contains all the points which meet the requirements of the ODE.</p>
<p>For example, for the equation <img src="y%27%20%3D%202x" alt="y\' = 2x" title="y' = 2x"> this plane looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> mplcatppuccin
<span style="color:#f92672">import</span> matplotlib <span style="color:#66d9ef">as</span> mpl
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">from</span> mpl_toolkits.mplot3d <span style="color:#f92672">import</span> Axes3D

mpl<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>use(<span style="color:#e6db74">&#34;macchiato&#34;</span>)

<span style="color:#75715e"># Create a grid of values for x and y</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">100</span>)
y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>)
x, y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)

<span style="color:#75715e"># Calculate corresponding z</span>
z <span style="color:#f92672">=</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>x)

<span style="color:#75715e"># Create a figure and a 3D axis</span>
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>, projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
ax<span style="color:#f92672">.</span>plot_surface(x, z,y, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>)

<span style="color:#75715e"># Set labels</span>
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;X&#39;</span>)
ax<span style="color:#f92672">.</span>set_zlabel(<span style="color:#e6db74">&#39;Y&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;Y&#39;&#34;</span>)

<span style="color:#75715e"># Show the plot</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><img src="post-3_files/figure-markdown_strict/cell-2-output-1.png" width="410" height="396" />
<p>Then a specific solution to the ODE exists as a curve that sits on this plane. For example, for the IVP that starts at (0,0), the solution follows this curve:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Lx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">100</span>)
Ly <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> Lx])

<span style="color:#75715e"># Create masks for the conditions</span>
mask <span style="color:#f92672">=</span> (Lx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">&amp;</span> (Lx <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;</span> (Ly <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">100</span>) <span style="color:#f92672">&amp;</span> (Ly <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># Now apply the mask to both arrays to exclude unwanted values</span>
filtered_Lx <span style="color:#f92672">=</span> Lx[mask]
filtered_Ly <span style="color:#f92672">=</span> Ly[mask]

Lz <span style="color:#f92672">=</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>filtered_Lx) <span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>

<span style="color:#75715e"># Create a new figure</span>
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>, projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>,computed_zorder<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)

<span style="color:#75715e"># Plot surface and line</span>
ax<span style="color:#f92672">.</span>plot_surface(x, z,y, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>)
ax<span style="color:#f92672">.</span>plot(filtered_Lx, Lz, filtered_Ly, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>,linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dashed&#39;</span> , zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)


<span style="color:#75715e"># Set labels</span>
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;X&#39;</span>)
ax<span style="color:#f92672">.</span>set_zlabel(<span style="color:#e6db74">&#39;Y&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;Y&#39;&#34;</span>)

<span style="color:#75715e"># Show the plot</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><img src="post-3_files/figure-markdown_strict/cell-3-output-1.png" width="410" height="396" />
<h2 id="but-why-does-this-matter">But Why Does This Matter</h2>
<p>The reason that we want to reframe ODEs in this way is because of the following fact:</p>
<p><strong>For all constant-linear ODEs, we can express the ODE as a matrix such that applying it to any point in the vector space would map any point to a valid point on the curve defined by the ODE</strong></p>
<p>Looking at the equations above, these matrices (<img src="T" alt="" title="T">) are:</p>
<ol>
<li>
<p>Simple Harmonic Motion:</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%20-%5Comega%5E2%20%26%200%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 1 & 0 & 0 & 0\\0 & 0 & 1 & 0 & 0\\0 & 0 & 0 & 1 & 0\\0 & 0 & -\omega^2 & 0 & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; -\omega^2 &amp; 0 &amp; 0\
\end{bmatrix}"></p>
</li>
<li>
<p>Radioactive Decay:</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%20-%5Clambda%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\\0 & 0 & -\lambda & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; -\lambda &amp; 0\
\end{bmatrix}"></p>
</li>
<li>
<p>RC Circuit Equation:</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%20%5Cfrac%7B-1%7D%7BRC%7D%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\\0 & 0 & \frac{-1}{RC} & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; \frac{-1}{RC} &amp; 0\
\end{bmatrix}"></p>
</li>
<li>
<p>Damped Harmonic Oscillator:</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%20-%5Comega%5E2%20%26%20-2%5Cgamma%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 1 & 0 & 0 & 0\\0 & 0 & 1 & 0 & 0\\0 & 0 & 0 & 1 & 0\\0 & 0 & -\omega^2 & -2\gamma & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; -\omega^2 &amp; -2\gamma &amp; 0\
\end{bmatrix}"></p>
</li>
<li>
<p>Heat Equation (One-Dimensional):</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%20%5Cfrac%7B1%7D%7B%5Calpha%7D%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 1 & 0 & 0 & 0\\0 & 0 & 1 & 0 & 0\\0 & 0 & 0 & 1 & 0\\0 & 0 & 0 & \frac{1}{\alpha} & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; 0 &amp; \frac{1}{\alpha} &amp; 0\
\end{bmatrix}"></p>
</li>
<li>
<p>Exponential Growth or Decay:</p>
<p><img src="T%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%20k%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T = \begin{bmatrix}1 & 0 & 0 & 0\\0 & 1 & 0 & 0\\0 & 0 & 1 & 0\\0 & 0 & k & 0\\\end{bmatrix}" title="T = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; k &amp; 0\
\end{bmatrix}"></p>
</li>
</ol>
<h2 id="using-these-to-fit-odes">Using these to fit ODEs</h2>
<p>Now that we can express the ODEs in the form of a matrix, we can implement these matriexies in the ODE solver package to make the solution fit the ode.
It&rsquo;s important here to note that I&rsquo;ve diverted from my old definitions of <img src="Y" alt="" title="Y"> here, where the first element of the vector is <img src="y%28x%29" alt="y(x)" title="y(x)">.</p>
<p>To make a step in the approximation we use the following equation:</p>
<p><img src="%5Cbegin%7Bbmatrix%7D%0A1%20%5C%5C%0Ax%2Bh%20%5C%5C%20%0Ay%28x%2Bh%29%5C%5C%0Ay%27%28x%2Bh%29%5C%5C%0Ay%27%27%28x%2Bh%29%5C%5C%0A...%5C%5C%0Ay%5E%7Bn%7D%28x%2Bh%29%5C%5C%0A%5Cend%7Bbmatrix%7D%20%3D%20%20S%20%5Ccdot%20%5Cbegin%7Bbmatrix%7D%0A1%20%5C%5C%0Ax%5C%5C%0Ay%28x%29%5C%5C%0Ay%27%28x%29%5C%5C%0Ay%27%27%28x%29%5C%5C%0A...%5C%5C%0Ay%5E%7Bn%7D%28x%29%5C%5C%0A%5Cend%7Bbmatrix%7D%0A%5Cepsilon" alt="\begin{bmatrix}1 \\x+h \\y(x+h)\\y\'(x+h)\\y\'\'(x+h)\\\...\\y^{n}(x+h)\\\end{bmatrix} =  S \cdot \begin{bmatrix}1 \\x\\y(x)\\y\'(x)\\y\'\'(x)\\\...\\y^{n}(x)\\\end{bmatrix}\epsilon" title="\begin{bmatrix}
1 \
x+h \ 
y(x+h)\
y'(x+h)\
y''(x+h)\
...\
y^{n}(x+h)\
\end{bmatrix} =  S \cdot \begin{bmatrix}
1 \
x\
y(x)\
y'(x)\
y''(x)\
...\
y^{n}(x)\
\end{bmatrix}
\epsilon"></p>
<p>Where <img src="S" alt="" title="S"> is:</p>
<p><img src="%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%20%26%20...%20%26%200%20%5C%5C%0Ah%20%26%201%20%26%200%20%26%200%20%26%200%20%26%20...%20%26%200%20%5C%5C%0A0%20%26%200%20%26%201%20%26%20%5Cfrac%7Bh%7D%7B1%21%7D%20%26%20%5Cfrac%7Bh%5E2%7D%7B2%21%7D%20%26%20%20...%20%26%20%5Cfrac%7Bh%5En%7D%7Bn%21%7D%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%20%5Cfrac%7Bh%7D%7B1%21%7D%20%26%20%20...%20%26%20%5Cfrac%7Bh%5E%7Bn-1%7D%7D%7B%28n-1%29%21%7D%5C%5C%0A0%20%26%200%20%26%200%20%26%200%20%26%201%20%26%20%20...%20%26%20%5Cfrac%7Bh%5E%7Bn-2%7D%7D%7B%28n-2%29%21%7D%5C%5C%0A...%20%26%20...%20%26%20...%20%26%20...%20%26%20%20...%20%26%20...%5C%5C%0A0%20%26%200%20%26%200%20%26%200%20%26%200%20%26%20%20...%20%26%201%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="\begin{bmatrix}1 & 0 & 0 & 0 & 0 & \... & 0 \\h & 1 & 0 & 0 & 0 & \... & 0 \\0 & 0 & 1 & \frac{h}{1!} & \frac{h^2}{2!} &  \... & \frac{h^n}{n!}\\0 & 0 & 0 & 1 & \frac{h}{1!} &  \... & \frac{h^{n-1}}{(n-1)!}\\0 & 0 & 0 & 0 & 1 &  \... & \frac{h^{n-2}}{(n-2)!}\\\... & \... & \... & \... &  \... & \...\\0 & 0 & 0 & 0 & 0 &  \... & 1\\\end{bmatrix}" title="\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; ... &amp; 0 \
h &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; ... &amp; 0 \
0 &amp; 0 &amp; 1 &amp; \frac{h}{1!} &amp; \frac{h^2}{2!} &amp;  ... &amp; \frac{h^n}{n!}\
0 &amp; 0 &amp; 0 &amp; 1 &amp; \frac{h}{1!} &amp;  ... &amp; \frac{h^{n-1}}{(n-1)!}\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp;  ... &amp; \frac{h^{n-2}}{(n-2)!}\
... &amp; ... &amp; ... &amp; ... &amp;  ... &amp; ...\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;  ... &amp; 1\
\end{bmatrix}"></p>
<p>When making this step, the error in the approximation will move the point away from the plane that contains all valid solutions to the ODE, and therefore we will have to snap it back using one of the transformation matrices (<img src="T" alt="" title="T">).</p>
<p>Implementing this method in our python library:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expanded_euler</span>(dims, h):
    step_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((dims, dims))
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(i, dims):
            <span style="color:#75715e"># Is 1, and h at j-i =0, 1 respectively</span>
            step_matrix[i, j] <span style="color:#f92672">=</span> h <span style="color:#f92672">**</span> (j <span style="color:#f92672">-</span> i) <span style="color:#f92672">/</span> math<span style="color:#f92672">.</span>factorial(j <span style="color:#f92672">-</span> i)
    expanded_matrix <span style="color:#f92672">=</span> add_x_and_1(step_matrix, h)
    <span style="color:#66d9ef">return</span> expanded_matrix


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_x_and_1</span>(original_matrix, h):
    new_size <span style="color:#f92672">=</span> len(original_matrix) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>
    new_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((new_size, new_size), dtype<span style="color:#f92672">=</span>original_matrix<span style="color:#f92672">.</span>dtype)

    <span style="color:#75715e"># Set the 2x2 top left matrix</span>
    new_matrix[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [h, <span style="color:#ae81ff">1</span>]]

    <span style="color:#75715e"># Copy the original matrix to the bottom right of the new matrix.</span>
    new_matrix[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">=</span> original_matrix
    <span style="color:#66d9ef">return</span> new_matrix


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linear</span>(y, step_matrix_generator, transformation_matrix, steps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, h<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>):
    dims <span style="color:#f92672">=</span> len(y) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
    step_matrix <span style="color:#f92672">=</span> transformation_matrix <span style="color:#f92672">@</span> step_matrix_generator(dims, h)
    output_list <span style="color:#f92672">=</span> []

    y_n <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>copy()
    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> steps:
        y_n <span style="color:#f92672">=</span> step_matrix <span style="color:#f92672">@</span> y_n
        output_list<span style="color:#f92672">.</span>append(y_n)
        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>Bind this machinery together, and you get a tool capable of tackling the initial example of <img src="y%27%20%3D%202x" alt="y\' = 2x" title="y' = 2x"> passing through the point (0,0):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> math


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
    <span style="color:#66d9ef">def</span> __init__(self, input_list: list):
        solution_list <span style="color:#f92672">=</span> sorted(input_list, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">1</span>])

        dims <span style="color:#f92672">=</span> len(solution_list[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
        self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([x[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> input_list])

        value_lists <span style="color:#f92672">=</span> [[] <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(dims)]

        <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input_list:
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
                value_lists[i]<span style="color:#f92672">.</span>append(v[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>])

        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
            self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;y_</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(value_lists[i])

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">interpolate</span>(self, x, y_n):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        allows you to get any value from the solution by interpolating the points
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        y_values <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;y_</span><span style="color:#e6db74">{</span>y_n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>]

        x_max_index <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(self<span style="color:#f92672">.</span>x <span style="color:#f92672">&gt;=</span> x)[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
        x_min_index <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(self<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;=</span> x)[<span style="color:#ae81ff">0</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]

        x_at_x_max <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x[x_max_index]
        x_at_x_min <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x[x_min_index]

        y_at_x_max <span style="color:#f92672">=</span> y_values[x_max_index]
        y_at_x_min <span style="color:#f92672">=</span> y_values[x_min_index]

        slope <span style="color:#f92672">=</span> (y_at_x_max <span style="color:#f92672">-</span> y_at_x_min) <span style="color:#f92672">/</span> (x_at_x_max <span style="color:#f92672">-</span> x_at_x_min)

        value <span style="color:#f92672">=</span> y_at_x_min <span style="color:#f92672">+</span> slope <span style="color:#f92672">*</span> (x <span style="color:#f92672">-</span> x_at_x_min)
        <span style="color:#66d9ef">return</span> value

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linear</span>(y, step_matrix_generator, transformation_matrix, steps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, h<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>):
    dims <span style="color:#f92672">=</span> len(y) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
    step_matrix <span style="color:#f92672">=</span> transformation_matrix <span style="color:#f92672">@</span> step_matrix_generator(dims, h)
    output_list <span style="color:#f92672">=</span> []

    y_n <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>copy()
    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> steps:
        y_n <span style="color:#f92672">=</span> step_matrix <span style="color:#f92672">@</span> y_n
        output_list<span style="color:#f92672">.</span>append(y_n)
        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">return</span> Solution(output_list)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">init_y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>] <span style="color:#75715e">#[1,x,y,y&#39;]</span>
transformation_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
   [ <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span> ],
   [ <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span> ],
   [ <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span> ],
   [ <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span> ]
])
solution <span style="color:#f92672">=</span> linear(
    init_y,
    expanded_euler,
    transformation_matrix,
    steps<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, h<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>plot(solution<span style="color:#f92672">.</span>x, solution<span style="color:#f92672">.</span>y_0, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Approximated Solution&#39;</span>)
plt<span style="color:#f92672">.</span>plot(solution<span style="color:#f92672">.</span>x, solution<span style="color:#f92672">.</span>x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Solution&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>) <span style="color:#75715e"># Label for the x-axis</span>
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;y&#39;</span>) <span style="color:#75715e"># Label for the y-axis</span>
plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>) <span style="color:#75715e"># Show a grid for better readability</span>
plt<span style="color:#f92672">.</span>legend()
plt<span style="color:#f92672">.</span>show()
</code></pre></div><img src="post-3_files/figure-markdown_strict/cell-7-output-1.png" width="663" height="429" />
<h1 id="whats-next">What&rsquo;s Next?</h1>
<p>This method seems to work pretty well and follows the true solution pretty closely. I&rsquo;m going to stop here for now but there are many things on my wishlist that I want to build in later posts. This includes:</p>
<ul>
<li>Solving IVPs which aren&rsquo;t constant-linear</li>
<li>Solving BVPs</li>
<li>Applying this method to PDEs</li>
</ul>
<p>Stay tuned for more posts in this series where I try to implement these features into my solver!</p>
</div>
  </article>

  <hr />

  <div class="post-info">
    
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="/tags/calculus/">Calculus</a></span>
        <span class="tag"><a href="/tags/algebra/">Algebra</a></span>
        <span class="tag"><a href="/tags/python/">Python</a></span>
        
    </p>
 

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-file-text"
      >
        <path
          d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
        ></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      1179 Words
    </p>
  </div>

  
</main>

            </div>

            
                <footer class="footer">
  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/matlab.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  <script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>





    
    <script src="/js/menu.js"></script>
</footer>

</body>
</html>

            
        </div>

        
    </body>
</html>

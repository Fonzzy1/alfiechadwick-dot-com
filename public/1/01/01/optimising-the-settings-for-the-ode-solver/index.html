<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta
  name="author"
  content="Alfie Chadwick"
/>
<meta
  name="description"
  content="import numpy as np import math import matplotlib.pyplot as plt import numpy as np import mplcatppuccin import matplotlib as mpl import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D mpl.style.use(&amp;#34;macchiato&amp;#34;) def expanded_euler(dims, h): step_matrix = np.zeros((dims, dims)) for i in range(dims): for j in range(i, dims): # Is 1, and h at j-i =0, 1 respectively step_matrix[i, j] = h ** (j - i) / math.factorial(j - i) expanded_matrix = add_x_and_1(step_matrix, h) return expanded_matrix def add_x_and_1(original_matrix, h): new_size = len(original_matrix) &#43; 2 new_matrix = np."
/>
<meta
  name="keywords"
  content=", Calculus, Algebra"
/>
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/1/01/01/optimising-the-settings-for-the-ode-solver/" />

<title>
   Optimising the settings for the ODE solver :: Alfie Chadwick  
</title>


 
<link
  rel="stylesheet"
  href="/main.a9ab624e85e095bcf95bb267aad409c118b491d4ab8297e6d81ced1812528418.css"
  integrity="sha256-qatiToXglbz5W7JnqtQJwRi0kdSrgpfm2BztGBJShBg="
/>



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">
 <meta itemprop="name" content="Optimising the settings for the ODE solver">
<meta itemprop="description" content="import numpy as np import math import matplotlib.pyplot as plt import numpy as np import mplcatppuccin import matplotlib as mpl import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D mpl.style.use(&#34;macchiato&#34;) def expanded_euler(dims, h): step_matrix = np.zeros((dims, dims)) for i in range(dims): for j in range(i, dims): # Is 1, and h at j-i =0, 1 respectively step_matrix[i, j] = h ** (j - i) / math.factorial(j - i) expanded_matrix = add_x_and_1(step_matrix, h) return expanded_matrix def add_x_and_1(original_matrix, h): new_size = len(original_matrix) &#43; 2 new_matrix = np.">

<meta itemprop="wordCount" content="1059">
<meta itemprop="keywords" content="Calculus,Algebra," /> <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Optimising the settings for the ODE solver"/>
<meta name="twitter:description" content="import numpy as np import math import matplotlib.pyplot as plt import numpy as np import mplcatppuccin import matplotlib as mpl import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D mpl.style.use(&#34;macchiato&#34;) def expanded_euler(dims, h): step_matrix = np.zeros((dims, dims)) for i in range(dims): for j in range(i, dims): # Is 1, and h at j-i =0, 1 respectively step_matrix[i, j] = h ** (j - i) / math.factorial(j - i) expanded_matrix = add_x_and_1(step_matrix, h) return expanded_matrix def add_x_and_1(original_matrix, h): new_size = len(original_matrix) &#43; 2 new_matrix = np."/>
   









<link  rel='stylesheet' type='text/css' href="//cdn.jsdelivr.net/npm/@catppuccin/highlightjs@0.1.4/css/catppuccin-macchiato.css">
<style>
    pre code.hljs {
        display: block;
        overflow-x: auto;
        padding: 1em;
        background: #1e2030 ;
    }

    code.hljs {
        padding: 3px 5px;
    }
</style>











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#bb9af7;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
  <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/post/">Posts</a></li><li><a href="/tags">Tags</a></li>
  </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
<main class="post">
  <div class="post-info">
    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-clock"
      >
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      5 minutes 
    </p>

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-calendar"
      >
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      
       0001-01-01 

      
      
    </p>
  </div>

  <article>
    <h1 class="post-title">
      <a href="/1/01/01/optimising-the-settings-for-the-ode-solver/">Optimising the settings for the ODE solver</a>
    </h1>

      

    <div class="post-content"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> math
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> mplcatppuccin
<span style="color:#f92672">import</span> matplotlib <span style="color:#66d9ef">as</span> mpl
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">from</span> mpl_toolkits.mplot3d <span style="color:#f92672">import</span> Axes3D
mpl<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>use(<span style="color:#e6db74">&#34;macchiato&#34;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expanded_euler</span>(dims, h):
    step_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((dims, dims))
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(i, dims):
            <span style="color:#75715e"># Is 1, and h at j-i =0, 1 respectively</span>
            step_matrix[i, j] <span style="color:#f92672">=</span> h <span style="color:#f92672">**</span> (j <span style="color:#f92672">-</span> i) <span style="color:#f92672">/</span> math<span style="color:#f92672">.</span>factorial(j <span style="color:#f92672">-</span> i)
    expanded_matrix <span style="color:#f92672">=</span> add_x_and_1(step_matrix, h)
    <span style="color:#66d9ef">return</span> expanded_matrix


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_x_and_1</span>(original_matrix, h):
    new_size <span style="color:#f92672">=</span> len(original_matrix) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>
    new_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((new_size, new_size), dtype<span style="color:#f92672">=</span>original_matrix<span style="color:#f92672">.</span>dtype)
    <span style="color:#75715e"># Set the 2x2 top left matrix</span>
    new_matrix[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [h, <span style="color:#ae81ff">1</span>]]
    <span style="color:#75715e"># Copy the original matrix to the bottom right of the new matrix.</span>
    new_matrix[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">=</span> original_matrix
    <span style="color:#66d9ef">return</span> new_matrix



<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
    <span style="color:#66d9ef">def</span> __init__(self, input_list: list):
        solution_list <span style="color:#f92672">=</span> sorted(input_list, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">1</span>])
        dims <span style="color:#f92672">=</span> len(solution_list[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
        self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([x[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> input_list])
        value_lists <span style="color:#f92672">=</span> [[] <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(dims)]
        <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input_list:
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
                value_lists[i]<span style="color:#f92672">.</span>append(v[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>])
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(dims):
            self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;y_</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(value_lists[i])
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">interpolate</span>(self, x, y_n):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        allows you to get any value from the solution by interpolating the points
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        y_values <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;y_</span><span style="color:#e6db74">{</span>y_n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>]
        x_max_index <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(self<span style="color:#f92672">.</span>x <span style="color:#f92672">&gt;=</span> x)[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
        x_min_index <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(self<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;=</span> x)[<span style="color:#ae81ff">0</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
        x_at_x_max <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x[x_max_index]
        x_at_x_min <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>x[x_min_index]
        y_at_x_max <span style="color:#f92672">=</span> y_values[x_max_index]
        y_at_x_min <span style="color:#f92672">=</span> y_values[x_min_index]
        slope <span style="color:#f92672">=</span> (y_at_x_max <span style="color:#f92672">-</span> y_at_x_min) <span style="color:#f92672">/</span> (x_at_x_max <span style="color:#f92672">-</span> x_at_x_min)
        value <span style="color:#f92672">=</span> y_at_x_min <span style="color:#f92672">+</span> slope <span style="color:#f92672">*</span> (x <span style="color:#f92672">-</span> x_at_x_min)
        <span style="color:#66d9ef">return</span> value

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linear</span>(y, step_matrix_generator, transformation_matrix, steps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, h<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>):
    dims <span style="color:#f92672">=</span> len(y) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>
    step_matrix <span style="color:#f92672">=</span> transformation_matrix <span style="color:#f92672">@</span> step_matrix_generator(dims, h)
    output_list <span style="color:#f92672">=</span> []
    y_n <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>copy()
    i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> steps:
        y_n <span style="color:#f92672">=</span> step_matrix <span style="color:#f92672">@</span> y_n
        output_list<span style="color:#f92672">.</span>append(y_n)
        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">return</span> Solution(output_list)
</code></pre></div><p>In the <a href="../../../2024/01/12/making-my-ode-solver-solve-odes/">last post</a> in this series, I introduced my method for approximating ODEs. But after re-rereading it, I found myself questioning the step where I convert the ODE into a matrix.</p>
<p>This is best exemplified by the ODE <img src="y%27%27%20%3D%20x%20%2B%20y" alt="y\'\' = x + y" title="y'' = x + y"> which goes through the point <img src="y%280%29%20%3D%201" alt="y(0) = 1" title="y(0) = 1"> and <img src="y%27%28x%29%20%3D%201" alt="y\'(x) = 1" title="y'(x) = 1">. Converting it into a matrix, we would define <img src="T" alt="" title="T"> as:</p>
<p><img src="T_1%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%201%20%26%201%20%26%200%20%26%200%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_1 = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 1 & 0 & 0 & 0\\0 & 0 & 1 & 0 & 0\\0 & 0 & 0 & 1 & 0\\0 & 1 & 1 & 0 & 0\\\end{bmatrix}" title="T_1 = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 1 &amp; 1 &amp; 0 &amp; 0\
\end{bmatrix}"></p>
<p>However, rearranging this ODE into <img src="x%20%3D%20y%27%27%20-%20y" alt="x = y\'\' - y" title="x = y'' - y"> or <img src="y%20%3D%20y%27%27%20-%20x" alt="y = y\'\' - x" title="y = y'' - x">, it would be just as reasonable to define T as:</p>
<p><img src="T_2%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%20-1%20%26%200%20%26%201%5C%5C%0A0%20%26%200%20%26%201%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%200%20%26%201%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_2 = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 0 & -1 & 0 & 1\\0 & 0 & 1 & 0 & 0\\0 & 0 & 0 & 1 & 0\\0 & 0 & 0 & 0 & 1\\\end{bmatrix}" title="T_2 = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; -1 &amp; 0 &amp; 1\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\
\end{bmatrix}"></p>
<p><img src="T_3%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%20-1%20%26%200%20%26%200%20%26%201%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%200%5C%5C%0A0%20%26%200%20%26%200%20%26%200%20%26%201%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_3 = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\0 & 1 & 0 & 0 & 0\\0 & -1 & 0 & 0 & 1\\0 & 0 & 0 & 1 & 0\\0 & 0 & 0 & 0 & 1\\\end{bmatrix}" title="T_3 = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; -1 &amp; 0 &amp; 0 &amp; 1\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\
\end{bmatrix}"></p>
<p>So does this matter? Since they are all equaly valid ways of representing the ODE, surley they will all lead to the same conclusion. However Using each of these matrices the ODE we get very different solutions. <img src="T1" alt="" title="T1"> is the closet, <img src="T3" alt="" title="T3"> and <img src="T2" alt="" title="T2"> are both equally far off.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">init_y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>] <span style="color:#75715e">#[1,x,y,y&#39;]</span>
T1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]
])

T2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]
])

T3 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
    [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>],
    [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]
])
steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>

solution1 <span style="color:#f92672">=</span> linear(
    init_y,
    expanded_euler,
    T1,
    steps<span style="color:#f92672">=</span>steps, h<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>steps)
    
solution2 <span style="color:#f92672">=</span> linear(
    init_y,
    expanded_euler,
    T2,
    steps<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>steps, h<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>steps)
solution3 <span style="color:#f92672">=</span> linear(
    init_y,
    expanded_euler,
    T3,
    steps<span style="color:#f92672">=</span>steps, h<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>steps)


plt<span style="color:#f92672">.</span>plot(solution1<span style="color:#f92672">.</span>x, solution1<span style="color:#f92672">.</span>y_0, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T1 Aproximated Solution&#39;</span>)
plt<span style="color:#f92672">.</span>plot(solution2<span style="color:#f92672">.</span>x, solution2<span style="color:#f92672">.</span>y_0, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T2 Aproximated Solution&#39;</span>)
plt<span style="color:#f92672">.</span>plot(solution3<span style="color:#f92672">.</span>x, solution3<span style="color:#f92672">.</span>y_0, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T3 Aproximated Solution&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
plt<span style="color:#f92672">.</span>plot(solution1<span style="color:#f92672">.</span>x, <span style="color:#f92672">-</span>solution1<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span>(<span style="color:#f92672">-</span>solution1<span style="color:#f92672">.</span>x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span>solution1<span style="color:#f92672">.</span>x, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Solution&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>) <span style="color:#75715e"># Label for the x-axis</span>
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;y&#39;</span>) <span style="color:#75715e"># Label for the y-axis</span>
plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>) <span style="color:#75715e"># Show a grid for better readability</span>
plt<span style="color:#f92672">.</span>legend()
plt<span style="color:#f92672">.</span>show()
</code></pre></div><img src="post-4_files/figure-markdown_strict/cell-3-output-1.png" width="663" height="430" />
<h2 id="truncation-error">Truncation Error</h2>
<p>Truncation error is the error that is introduced by approximating a infinite series, such as the Taylor series we use, with a finite number of terms. I&rsquo;m suspecting in this case, that <img src="T_1" alt="" title="T_1"> introduces the least amount of truncation error at each step and this is why it is the best aproximation of the ODE.</p>
<p>We can define our truncation error (<img src="R" alt="" title="R">) as the difference be the true value (<img src="Y%5E%2A" alt="Y^\*" title="Y^*">) and the predicted value (<img src="Y" alt="" title="Y">). In our aproximation, this is defined as:</p>
<p><img src="R%20%3D%20Y%5E%2A%28x%2Bh%29%20-%20Y%28x%2Bh%29%20%3D%20Y%5E%2A%28x%2Bh%29%20-%20T%20%5Ccdot%20S%20%5Ccdot%20Y%28x%29" alt="R = Y^\*(x+h) - Y(x+h) = Y^\*(x+h) - T \cdot S \cdot Y(x)" title="R = Y^*(x+h) - Y(x+h) = Y^*(x+h) - T \cdot S \cdot Y(x)"></p>
<p>Where <img src="S" alt="" title="S"> is the stepping matrix and <img src="T" alt="" title="T"> is the transformation matrix.</p>
<p>Since our approximation is based on the Taylor series, the truncation error is the remaining terms in the series that aren&rsquo;t used. When <img src="k" alt="" title="k"> terms of the taylor series are used, the truncation error (<img src="r" alt="" title="r">) is :</p>
<p><img src="r%20%3D%20%5Csum_%7Bn%20%3D%20k%2B2%7D%5E%7B%5Cinfty%7D%20%20%5Cfrac%7B%5Cmathbb%20y%5E%7Bn%7D%28x%29%7D%7Bn%21%7D%5Ccdot%28h%29%5En" alt="r = \sum\_{n = k+2}^{\infty}  \frac{\mathbb y^{n}(x)}{n!}\cdot(h)^n" title="r = \sum_{n = k+2}^{\infty}  \frac{\mathbb y^{n}(x)}{n!}\cdot(h)^n"></p>
<p>Since <img src="y%5E%7Bn%7D" alt="y^{n}" title="y^{n}"> be pulled out as a constant for a given step, the limit of the magnitude of this error can be defined using big-O notation, such that when <img src="k" alt="" title="k"> terms are used, <img src="r" alt="" title="r"> is <img src="O%28h%5E%7Bk%2B3%7D%29" alt="O(h^{k+3})" title="O(h^{k+3})">.</p>
<p>Looking at just the stepping matrix, we can see the truncation error is:</p>
<p><img src="S%20%3D%20%5Cbegin%7Bbmatrix%7D%0A1%20%26%200%20%26%200%20%26%200%20%26%200%5C%5C%0A1%20%26%201%20%26%200%20%26%200%20%26%200%5C%5C%0A0%20%26%200%20%26%201%20%26%20h%20%26%20%5Cfrac%7Bh%5E2%7D%7B2%7D%5C%5C%0A0%20%26%200%20%26%200%20%26%201%20%26%20h%5C%5C%0A0%20%26%200%20%26%200%20%26%200%20%26%201%5C%5C%0A%5Cend%7Bbmatrix%7D%20%5Crightarrow%20R%20%3D%20%20%5Cbegin%7Bbmatrix%7D%0A0%5C%5C%0A0%5C%5C%0AO%28h%5E3%29%5C%5C%0AO%28h%5E2%29%5C%5C%0AO%28h%29%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="S = \begin{bmatrix}1 & 0 & 0 & 0 & 0\\1 & 1 & 0 & 0 & 0\\0 & 0 & 1 & h & \frac{h^2}{2}\\0 & 0 & 0 & 1 & h\\0 & 0 & 0 & 0 & 1\\\end{bmatrix} \rightarrow R =  \begin{bmatrix}0\\0\\O(h^3)\\O(h^2)\\O(h)\\\end{bmatrix}" title="S = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\
1 &amp; 1 &amp; 0 &amp; 0 &amp; 0\
0 &amp; 0 &amp; 1 &amp; h &amp; \frac{h^2}{2}\
0 &amp; 0 &amp; 0 &amp; 1 &amp; h\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\
\end{bmatrix} \rightarrow R =  \begin{bmatrix}
0\
0\
O(h^3)\
O(h^2)\
O(h)\
\end{bmatrix}"></p>
<p>Taking it back to the above example of <img src="y%27%27%20%3D%20x%20%2B%20y" alt="y\'\' = x + y" title="y'' = x + y">, and the three transformation matrices it defines, we can apply the transformation matrices to the vector <img src="R" alt="" title="R"> of the standard stepping matrix to get the truncation error for each of the approximations.</p>
<p><img src="T_1%20%5Ccdot%20R%20%20%3D%20%5Cbegin%7Bbmatrix%7D%0A0%5C%5C%0A0%5C%5C%0AO%28h%5E3%29%5C%5C%0AO%28h%5E2%29%5C%5C%0AO%28h%5E3%29%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_1 \cdot R  = \begin{bmatrix}0\\0\\O(h^3)\\O(h^2)\\O(h^3)\\\end{bmatrix}" title="T_1 \cdot R  = \begin{bmatrix}
0\
0\
O(h^3)\
O(h^2)\
O(h^3)\
\end{bmatrix}"></p>
<p><img src="T_2%20%5Ccdot%20R%20%3D%20%5Cbegin%7Bbmatrix%7D%0A0%5C%5C%0AO%28h%29%5C%5C%0AO%28h%5E3%29%5C%5C%0AO%28h%5E2%29%5C%5C%0AO%28h%29%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_2 \cdot R = \begin{bmatrix}0\\O(h)\\O(h^3)\\O(h^2)\\O(h)\\\end{bmatrix}" title="T_2 \cdot R = \begin{bmatrix}
0\
O(h)\
O(h^3)\
O(h^2)\
O(h)\
\end{bmatrix}"></p>
<p><img src="T_3%20%5Ccdot%20R%20%20%3D%20%5Cbegin%7Bbmatrix%7D%0A0%5C%5C%0A0%5C%5C%0AO%28h%29%5C%5C%0AO%28h%5E2%29%5C%5C%0AO%28h%29%5C%5C%0A%5Cend%7Bbmatrix%7D" alt="T_3 \cdot R  = \begin{bmatrix}0\\0\\O(h)\\O(h^2)\\O(h)\\\end{bmatrix}" title="T_3 \cdot R  = \begin{bmatrix}
0\
0\
O(h)\
O(h^2)\
O(h)\
\end{bmatrix}"></p>
<p>Now looking at the magnitude of these vectors:</p>
<p><img src="%7CT_1%20%5Ccdot%20R%20%7C%20%3D%20%5Csqrt%7B%28O%28h%5E3%29%29%5E2%20%2B%20%28O%28h%5E2%29%29%5E2%20%2B%20%28O%28h%5E3%29%29%5E2%7D%20%3D%20O%28h%5E2%29" alt="\|T_1 \cdot R \| = \sqrt{(O(h^3))^2 + (O(h^2))^2 + (O(h^3))^2} = O(h^2)" title="|T_1 \cdot R | = \sqrt{(O(h^3))^2 + (O(h^2))^2 + (O(h^3))^2} = O(h^2)"></p>
<p><img src="%7CT_2%20%5Ccdot%20R%20%7C%20%3D%20%5Csqrt%7B%28O%28h%29%29%5E2%20%2B%20%28O%28h%5E3%29%29%5E2%20%2B%20%28O%28h%5E2%29%29%5E2%20%2B%20%28O%28h%29%29%5E2%7D%20%20%3D%20O%28h%29" alt="\|T_2 \cdot R \| = \sqrt{(O(h))^2 + (O(h^3))^2 + (O(h^2))^2 + (O(h))^2}  = O(h)" title="|T_2 \cdot R | = \sqrt{(O(h))^2 + (O(h^3))^2 + (O(h^2))^2 + (O(h))^2}  = O(h)"></p>
<p><img src="%7CT_3%20%5Ccdot%20R%20%7C%20%3D%20%5Csqrt%7B%28O%28h%29%29%5E2%20%2B%20%28O%28h%5E2%29%29%5E2%20%2B%20%28O%28h%29%29%5E2%7D%20%24%20%3D%20O%28h%29" alt="\|T_3 \cdot R \| = \sqrt{(O(h))^2 + (O(h^2))^2 + (O(h))^2} \$ = O(h)" title="|T_3 \cdot R | = \sqrt{(O(h))^2 + (O(h^2))^2 + (O(h))^2} $ = O(h)"></p>
<p>This shows that <img src="%7CT_1%20%5Ccdot%20R%20%7C" alt="\|T_1 \cdot R \|" title="|T_1 \cdot R |"> shrinks as <img src="h" alt="" title="h"> gets smaller faster than when you use <img src="T_2" alt="" title="T_2"> or <img src="T_3" alt="" title="T_3">.
More generally, you can say that <img src="T_1" alt="" title="T_1"> will lead to the least error.</p>
<p>Now these are the errors for each step, so now looking at the truncation error for the whole approximation, we can multiply the error by the number of steps.</p>
<p>Say we want to find the value for for the curve at <img src="x%3D1" alt="x=1" title="x=1">, we would need to take <img src="1%2Fh" alt="1/h" title="1/h"> steps to find this value.</p>
<p><img src="%7CT_1%20%5Ccdot%20R%20%7C%20%5Ccdot%20%5Cfrac%7B1%7D%7Bh%7D%20%3D%20O%28h%29" alt="\|T_1 \cdot R \| \cdot \frac{1}{h} = O(h)" title="|T_1 \cdot R | \cdot \frac{1}{h} = O(h)"></p>
<p><img src="%7CT_2%20%5Ccdot%20R%20%7C%20%5Ccdot%20%5Cfrac%7B1%7D%7Bh%7D%20%3D%20O%281%29" alt="\|T_2 \cdot R \| \cdot \frac{1}{h} = O(1)" title="|T_2 \cdot R | \cdot \frac{1}{h} = O(1)"></p>
<p><img src="%7CT_3%20%5Ccdot%20R%20%7C%20%5Ccdot%20%5Cfrac%7B1%7D%7Bh%7D%20%3D%20O%281%29" alt="\|T_3 \cdot R \| \cdot \frac{1}{h} = O(1)" title="|T_3 \cdot R | \cdot \frac{1}{h} = O(1)"></p>
<p>We can now test this by running some approximations with various values of h and the different matrices, the results for which are below. We can see that the <img src="T_1" alt="" title="T_1"> result follows the <img src="O%28h%29" alt="O(h)" title="O(h)"> curve while the <img src="T_2" alt="" title="T_2"> and <img src="T_3" alt="" title="T_3"> result follows the <img src="O%281%29" alt="O(1)" title="O(1)"> curve.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">h_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">500</span>]
t1_list <span style="color:#f92672">=</span> [] 
t3_list <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> h_list:
    t1_list<span style="color:#f92672">.</span>append( linear(
        init_y,
        expanded_euler,
        T1,
        steps<span style="color:#f92672">=</span>int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>h), h<span style="color:#f92672">=</span>h)<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">&#39;y_0&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span><span style="color:#ae81ff">1</span>))
        
    t3_list<span style="color:#f92672">.</span>append( linear(
        init_y,
        expanded_euler,
        T3,
        steps<span style="color:#f92672">=</span>int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>h), h<span style="color:#f92672">=</span>h)<span style="color:#f92672">.</span>__dict__[<span style="color:#e6db74">&#39;y_0&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.5</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>e<span style="color:#f92672">**</span><span style="color:#ae81ff">1</span>))

plt<span style="color:#f92672">.</span>figure()
plt<span style="color:#f92672">.</span>loglog(h_list, np<span style="color:#f92672">.</span>abs(t1_list), marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;-&#39;</span>,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T1 absolute error&#39;</span>)
plt<span style="color:#f92672">.</span>loglog(h_list, np<span style="color:#f92672">.</span>abs(t3_list), marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;-&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T2 and T3 absolute error&#39;</span>)
plt<span style="color:#f92672">.</span>loglog(h_list, [<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> h_list], linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dashed&#39;</span>,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;O(1) error&#39;</span>)
plt<span style="color:#f92672">.</span>loglog(h_list, [ h <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> h_list], linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dashed&#39;</span>,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;O(h) error&#39;</span>)
plt<span style="color:#f92672">.</span>loglog(h_list, [h<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> h_list], linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dashed&#39;</span>,label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;O(h^2) error&#39;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Step size&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Absolute Error&#39;</span>)
plt<span style="color:#f92672">.</span>legend()
plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><img src="post-4_files/figure-markdown_strict/cell-4-output-1.png" width="673" height="431" />
<p>So now trying to generalise this beyond the example we&rsquo;ve worked through, the reduction in error using the <img src="T_1" alt="" title="T_1"> matrix was caused by redefining the term with the most truncation error, <img src="y%27%27" alt="y\'\'" title="y''"> with terms with less truncation error, <img src="y" alt="" title="y"> and <img src="x" alt="" title="x">. Both <img src="T_2" alt="" title="T_2"> and <img src="T_3" alt="" title="T_3"> failed to do this.</p>
<p>So in general, to minimise error we should try to define the highest derivative in terms of the lower terms, as this will remove the <img src="O%28h%29" alt="O(h)" title="O(h)"> error from the truncation vector.</p>
</div>
  </article>

  <hr />

  <div class="post-info">
    
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="/tags/calculus/">Calculus</a></span>
        <span class="tag"><a href="/tags/algebra/">Algebra</a></span>
        
    </p>
 

    <p>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-file-text"
      >
        <path
          d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
        ></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      1059 Words
    </p>
  </div>

  
</main>

            </div>

            
                <footer class="footer">
  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/matlab.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  <script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>





    
    <script src="/js/menu.js"></script>
</footer>

</body>
</html>

            
        </div>

        
    </body>
</html>

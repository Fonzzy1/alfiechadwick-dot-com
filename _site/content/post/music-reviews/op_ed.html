<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alfie Chadwick">
<meta name="dcterms.date" content="2025-04-15">

<title>Fixing My Relationship with Spotify – Alfie Chadwick</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-7cf04a3b623d4438a22436c885baf8e8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-f4121a583bd226ebfc9de9ab57369267.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Alfie Chadwick</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/posts/postList.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/tags/tagList.html"> 
<span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/reviews/reviews.html"> 
<span class="menu-text">Reviews</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-passive-vs-the-active-consumer" id="toc-the-passive-vs-the-active-consumer" class="nav-link active" data-scroll-target="#the-passive-vs-the-active-consumer">The Passive vs The Active Consumer</a></li>
  <li><a href="#curation-as-a-shared-culture" id="toc-curation-as-a-shared-culture" class="nav-link" data-scroll-target="#curation-as-a-shared-culture">Curation as a shared culture</a></li>
  <li><a href="#how-to-make-spotify-more-curatable" id="toc-how-to-make-spotify-more-curatable" class="nav-link" data-scroll-target="#how-to-make-spotify-more-curatable">How to Make Spotify More Curatable</a>
  <ul class="collapse">
  <li><a href="#turn-of-auto-play" id="toc-turn-of-auto-play" class="nav-link" data-scroll-target="#turn-of-auto-play">Turn of Auto Play</a></li>
  <li><a href="#get-rid-of-liked-songs" id="toc-get-rid-of-liked-songs" class="nav-link" data-scroll-target="#get-rid-of-liked-songs">Get Rid of Liked Songs</a></li>
  <li><a href="#get-rid-of-recommendations" id="toc-get-rid-of-recommendations" class="nav-link" data-scroll-target="#get-rid-of-recommendations">Get Rid of Recommendations</a></li>
  <li><a href="#find-new-places-for-my-recommendations" id="toc-find-new-places-for-my-recommendations" class="nav-link" data-scroll-target="#find-new-places-for-my-recommendations">Find New Places for My Recommendations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fixing My Relationship with Spotify</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alfie Chadwick </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I grew up in a weird time for music and media in general. I am old enough to<br>
remember going to JB Hi-Fi to buy CDs and having piles of DVDs next to the TV,<br>
but I am also young enough to consider myself a part of the streaming-native<br>
generation. I first got Spotify at age 14, and I remember watching YouTube a few<br>
years before that.</p>
<p>Looking back at what my consumption habits were like when I was<br>
younger, I can only think that they have changed for the worse. Instead of<br>
watching movies or listening to albums, I now have playlists and the endless<br>
recommended videos from YouTube to fill my desires for media.</p>
<p>I’m scared that this is only going to get worse in the future. TikTok and the UX<br>
changes made by Spotify to put playlists front and centre in the experience have<br>
turned media into something disposable. The library of things to watch or listen<br>
to is transient, recommended by an algorithm only interested in making you<br>
consume more. In short, the enshitification of media and curation has come and<br>
is here to stay.</p>
<p>And call me a Luddite, but I do have this nostalgic dream of personal curation,<br>
where my library of media is mine to consume as I see fit, rather than curated<br>
by an algorithm. The growth of records and physical media in the last few years<br>
shows that this is not a unique want.</p>
<p>And as much as I would love to be the person who has all their films on DVD and<br>
only listens to records, the cost, both monetarily and time-wise, makes it out<br>
of reach for me right now. So instead, I want to work out how to make these<br>
systems, most importantly Spotify, work for me in my anti-algorithmic curation<br>
mindset.</p>
<section id="the-passive-vs-the-active-consumer" class="level2">
<h2 class="anchored" data-anchor-id="the-passive-vs-the-active-consumer">The Passive vs The Active Consumer</h2>
<p>The first step in this process is to work out what I’m not happy with on Spotify. It’s definitely not the ease of access and the value proposition of 15 dollars a month for pretty much all the music I can consume; it’s great. No, instead I think the issue is best exemplified by looking at my Spotify home screen.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="home-phone.png" class="img-fluid figure-img"></p>
<figcaption>My Spotify Home Screen</figcaption>
</figure>
</div>
<p>On it, we have nothing that I have selected myself. Instead, it is all curated playlists that resemble something that I might want to listen to. And on these playlists, as with most of the curated playlists made on Spotify, it’s a hodgepodge of songs that I definitely like, songs that resemble songs that I like, and then some songs that I don’t care for at all but Spotify thinks that I should like. All of these are present in an order that just doesn’t work.</p>
<p>However, because these are front and centre to my experience in Spotify, these are what I listen to. I do get some joy out of them, but it’s a very passive experience. At no point along the way am I deciding what I should be consuming; instead, I just take in what is given.</p>
<p>This behaviour is almost antithetical to my experience using iTunes and MP3 players. Here, my curation was active, with the closest thing to a recommendation system being my most played albums section. Everything that I heard was something that I chose because I wanted to listen to it.</p>
<p>The divide between active and passive curation is what makes me dislike my<br>
Spotify experience and nostalgise my time with my MP3 players. I think<br>
removing this passive curation process could go a long way to fixing my<br>
relationship with Spotify.</p>
</section>
<section id="curation-as-a-shared-culture" class="level2">
<h2 class="anchored" data-anchor-id="curation-as-a-shared-culture">Curation as a shared culture</h2>
<p>Say I remove my ‘passivley’ created playlists. This presents me with a new issue, how do I find new stuff?</p>
<p>I have been reliant on Spotify recommending me new songs for the last ten years to flesh out my library. I’m a regular user of my Discover Weekly playlist, and I found some of my favourite artists through their recommendations.</p>
<p>But I don’t think that this system is particularly good for embedding me into a shared culture, because it will only recommend things that I will probably like based on my previous listening. That means that when a great album comes out that doesn’t fit into my ‘taste’, it won’t be recommended. When Bad Bunny’s Debí Tirar Más Fotos came out, which is one of my favourite albums of the year so far, it took one of my friends playing it for me to find it. And it’s not like it’s a niche album; it’s currently number one for the albums of the year 2025 on <a href="https://www.albumoftheyear.org/">Album of the Year</a>. It’s just that Spotify decided that I wouldn’t like it.</p>
<p>I really dislike this approach to recommendations taken by Spotify. Let me decide if I don’t like something; let me try something new and out of the box rather than playing it safe. When I want to listen to something safe, I can choose to throw on the Wombats for the hundredth time, but at least that’s my decision.</p>
<p>This was something that I really liked about Letterboxd (when it had its five minutes in the spotlight); it exposed me to films that I wouldn’t have had in my Netflix recommendations. The experience of trying something that is recommended by another person rather than a machine contributes to a feeling of sonder, of the shared experience that the media we consume is not unique to ourselves but is part of a wider ecosystem, while the machine-based recommendations further entrench this individualism that is all too prevalent in our hyper-personalised reality.</p>
</section>
<section id="how-to-make-spotify-more-curatable" class="level2">
<h2 class="anchored" data-anchor-id="how-to-make-spotify-more-curatable">How to Make Spotify More Curatable</h2>
<section id="turn-of-auto-play" class="level3">
<h3 class="anchored" data-anchor-id="turn-of-auto-play">Turn of Auto Play</h3>
<p>This is a pretty simple one, but it does make a big difference. When I have nothing left in the queue, by default, Spotify will continue playing with recommendations. Turning this off will force me to at least choose what is being listened to.</p>
</section>
<section id="get-rid-of-liked-songs" class="level3">
<h3 class="anchored" data-anchor-id="get-rid-of-liked-songs">Get Rid of Liked Songs</h3>
<p>I think one of the main culprits of passive curation and consumption is Spotify’s implementation of the liked songs feature. Any time a song is playing, I can click on the + button and it will be added to the ‘liked songs’ playlist. This playlist becomes a dumping ground for all the songs that I like, but if I ever throw it on shuffle, it becomes unlistenable, similar to some of Spotify’s generated playlists.</p>
<p>Instead, there are two things I will do. The first is liking albums instead of songs. Artists put together albums to be a cohesive piece of work. Picking out songs (or playing them on shuffle) is akin to reading a book and skipping half the chapters and reading them out of order.</p>
<p>If I still want playlists, I will make a few instead of dumping songs into liked songs. This makes the act of liking a song more active and will hopefully result in more cohesive playlists.</p>
</section>
<section id="get-rid-of-recommendations" class="level3">
<h3 class="anchored" data-anchor-id="get-rid-of-recommendations">Get Rid of Recommendations</h3>
<p>On my phone, this is almost impossible; however, defaulting to looking at the library tab instead of home should present me with only things I have decided to add to my library.</p>
<p>On the computer, this is best fixed with the help of Spiceify. With it, I can download extensions that will remove recommendations from the client completely.</p>
<p>A couple I like are:</p>
<ul>
<li><a href="https://github.com/harbassan/spicetify-apps/blob/main/library">Library</a></li>
<li><a href="https://github.com/Akasiek/spicetify-lucky-lp">LuckyLP</a></li>
<li>Disable Homepage Recommendations</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="client.png" class="img-fluid figure-img"></p>
<figcaption>My Spotify client</figcaption>
</figure>
</div>
</section>
<section id="find-new-places-for-my-recommendations" class="level3">
<h3 class="anchored" data-anchor-id="find-new-places-for-my-recommendations">Find New Places for My Recommendations</h3>
<p>This is me trying to fix the problem of relying on personalised recommendations, so I think that anything that is personalised or ‘AI’ is out of the question. Instead, I’ve really enjoyed looking at reviews on <a href="https://pitchfork.com/">Pitchfork</a> or <a href="https://www.albumoftheyear.org/">Album of the Year</a>. Also, <a href="https://theshfl.com/">shfl</a> has been good tool for random recommendations. This will find me stuff that other people like, but not necessarily specific to me.</p>
<p>Also, just asking my friends about what they are listening to has been fun, plus Shazam has been really useful in finding the IDs of the tracks that I hear when I am out and about.</p>
<hr>
<p>I’m going to try implementing these over the next couple of weeks and see how my relationship changes. I’m hoping to see myself build a better relationship with Spotify and a stronger sense of ownership and control over my music library and habits.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
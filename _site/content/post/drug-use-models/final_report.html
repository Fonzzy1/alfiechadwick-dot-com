<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alfie Chadwick, Kevin Dai, Chrysovalantis Thomopoulos">
<meta name="dcterms.date" content="2023-10-22">

<title>Modeling Drug Use in Communities – Alfie Chadwick</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-0bfc47cc6585117dad3fa173ac69ce0a.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-57f0a2175cf6b1e1e8dfcb2d4390484b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Alfie Chadwick</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../content/index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../content/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preface" id="toc-preface" class="nav-link active" data-scroll-target="#preface">Preface</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#aim" id="toc-aim" class="nav-link" data-scroll-target="#aim">Aim</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method">Method</a>
  <ul class="collapse">
  <li><a href="#initial-model-sir" id="toc-initial-model-sir" class="nav-link" data-scroll-target="#initial-model-sir">Initial Model: SIR</a></li>
  <li><a href="#suar-model" id="toc-suar-model" class="nav-link" data-scroll-target="#suar-model">SUAR Model</a></li>
  <li><a href="#saur-model-with-age" id="toc-saur-model-with-age" class="nav-link" data-scroll-target="#saur-model-with-age">SAUR Model with age</a></li>
  <li><a href="#simplified-suar-model-with-age" id="toc-simplified-suar-model-with-age" class="nav-link" data-scroll-target="#simplified-suar-model-with-age">Simplified SUAR Model with age</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#appendix-1-stationary-points-of-sir-model" id="toc-appendix-1-stationary-points-of-sir-model" class="nav-link" data-scroll-target="#appendix-1-stationary-points-of-sir-model">Appendix 1 : Stationary points of SIR model</a></li>
  <li><a href="#appendix-2-stationary-points-of-suar" id="toc-appendix-2-stationary-points-of-suar" class="nav-link" data-scroll-target="#appendix-2-stationary-points-of-suar">Appendix 2 : Stationary points of SUAR</a></li>
  <li><a href="#appendix-3-critical-points-of-simplified-suar-model" id="toc-appendix-3-critical-points-of-simplified-suar-model" class="nav-link" data-scroll-target="#appendix-3-critical-points-of-simplified-suar-model">Appendix 3: Critical Points of Simplified SUAR model</a></li>
  <li><a href="#appendix-4-matlab-code-for-generating-conditional-stationary-points" id="toc-appendix-4-matlab-code-for-generating-conditional-stationary-points" class="nav-link" data-scroll-target="#appendix-4-matlab-code-for-generating-conditional-stationary-points">Appendix 4: Matlab code for generating conditional Stationary Points</a></li>
  <li><a href="#appendix-6-python-code-for-simulating-suar-model" id="toc-appendix-6-python-code-for-simulating-suar-model" class="nav-link" data-scroll-target="#appendix-6-python-code-for-simulating-suar-model">Appendix 6: Python code for simulating SUAR model</a></li>
  <li><a href="#appendix-7-python-code-for-simulating-20-compartment-suar-model" id="toc-appendix-7-python-code-for-simulating-20-compartment-suar-model" class="nav-link" data-scroll-target="#appendix-7-python-code-for-simulating-20-compartment-suar-model">Appendix 7: Python code for simulating 20 compartment SUAR model</a></li>
  <li><a href="#appendix-8-python-code-for-simulating-5-compartment-suar-model" id="toc-appendix-8-python-code-for-simulating-5-compartment-suar-model" class="nav-link" data-scroll-target="#appendix-8-python-code-for-simulating-5-compartment-suar-model">Appendix 8: Python code for simulating 5 compartment SUAR model</a></li>
  <li><a href="#appendix-9-python-code-for-simulating-5-compartment-dimensionless-suar-model" id="toc-appendix-9-python-code-for-simulating-5-compartment-dimensionless-suar-model" class="nav-link" data-scroll-target="#appendix-9-python-code-for-simulating-5-compartment-dimensionless-suar-model">Appendix 9: Python code for simulating 5 compartment dimensionless SUAR model</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling Drug Use in Communities</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alfie Chadwick, Kevin Dai, Chrysovalantis Thomopoulos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="preface" class="level1">
<h1>Preface</h1>
<p>This was written as a University project but I’m pretty happy with how it turned out.</p>
<p>Big thanks to Kevin Dai and Chrysovalantis Thomopoulos who worked with me on this throughout the semester.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Drugs are chemical substances with physiological effects. Some drugs like opioids, cannabis, alcohol, nicotine, cocaine, methamphetamine, or heroin are of concern to policymakers. Widespread drug abuse in a community can be a burden to society and the economy. For example, healthcare costs increase due to bodily harm, there is an enhanced risk of infectious diseases through second-hand needle injections, indirect funding of organized crime occurs, and there are negative impacts on mental health and rehabilitation. Further harms of drug abuse upon the abuser may include financial instability, death, and familial grief.</p>
<p>“Number one is the opioid epidemic. It is a scourge across our country. A person dies every 12-and-a-half minutes from an opioid overdose and that’s far too many. Especially when we know that many of those deaths can be prevented.” (Thedoctors.com, 2021)</p>
<p>These were the words of Dr.&nbsp;Adams, the 20th surgeon general of the United States when asked about his main concerns and focus indicating the severity of the matter. Substance abuse is not only harmful for oneself but our community. Multiple research articles and papers in the past have modeled drug use. We have included some examples below from which we have taken inspiration and made comparisons.</p>
<p>One article in particular by Mushanyu, J, Nyabadza, F, Muchatibaya, G, &amp; Stewart, A G. R. (2016) touches on the importance of an adequate healthcare system since a limited rehabilitation capacity can increase the chances of a drug abuse epidemic. The methods used in this paper are discussed later. Also, Mushanyu, J, Nyabadza, F, &amp; Stewart, A G R. (2015) focuses on some matters that are of great importance as well.</p>
<p>Having an understanding of the dynamics of drug use will inform decision makers’ strategies to minimize drug use. In this paper, we aim to understand how drug use and addiction develop in a community and what factors can be tweaked to alter the long-term distributions of drug use, abuse, and addiction in the community.</p>
</section>
<section id="aim" class="level1">
<h1>Aim</h1>
<p>The aim of this project is to produce a model to capture the dynamics of drug use in the long term. The model should address how or when individuals become drug users, addicted drug users, and abstainers, and have applications in addressing economic and policy decisions.</p>
</section>
<section id="method" class="level1">
<h1>Method</h1>
<section id="initial-model-sir" class="level2">
<h2 class="anchored" data-anchor-id="initial-model-sir">Initial Model: SIR</h2>
<p>It’s common to liken drug use to disease, treating drug addiction as an infection that can be recovered from. Using this analogy, we began looking into how diseases are modeled and how we can adapt our own model to fit drug usage. One of the simplest drug models is the SIR model, a compartment model based on the concept of mass action that sees infections as caused by interactions between infected people and susceptible people. The use of mass action can be justified in this case as we are looking at large populations over a long period of time, meaning that the variance in the movement will average out over time. There are a few reasons that this model is a good starting point for any type of drug modeling: Firstly, this model is very simple and can be easily adapted to our own needs with extra compartments and transferable conditions. Secondly, since we are looking at drug use in a population, relying on mass action rather than discrete modeling allows us to further simplify the model. Thirdly, the idea that addiction is caused by interactions between individuals seems to be a good assumption for drug use as one would expect people to become familiar and subsequently addicted to certain substances by being associated with people who have them.</p>
<p>One divergence we made from the most basic SIR model is allowing for relapse from the recovered group back into the infected group. This represents how recovering addicts will become addicted again at a different rate than people who have never used the drug before. However, an important fact is that people cannot move back into the susceptible group as addiction is said to last a lifetime.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../post/drug-use-models/pics/1.png" class="img-fluid figure-img"></p>
<figcaption>SIR Diagram</figcaption>
</figure>
</div>
<p>Our SIR model is defined by the following equations: <span class="math display">\[\frac{dS}{dt} = -\pi_1 * S * I \]</span> <span class="math display">\[\frac{dI}{dt} = \pi_1 * S * I + \pi_2 * R * I - \pi_3 *  I \]</span> <span class="math display">\[\frac{dR}{dt} = -\pi_2 * R * I + \pi_3 * I \]</span></p>
<p>The parameters <span class="math inline">\(\pi_1\)</span>, <span class="math inline">\(\pi_2\)</span>, and <span class="math inline">\(\pi_3\)</span> represent the ‘infectiousness’ of the drug for susceptible and recovering individuals and the rate of recovery from the drug, respectively.</p>
<p>We now look at some plots to see how this model behaves for various combinations of our parameters:</p>
<div id="4bcf92d3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mplcatppuccin</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mpl.style.use(<span class="st">"macchiato"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> euler_methods <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming SIR is a function that creates a plot and does not call plt.show()</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a 2 by 2 grid of subplots</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))  <span class="co"># Adjust the figure size if necessary</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># First plot</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>SIR(<span class="fl">0.001</span>, <span class="fl">0.02</span>, <span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Second plot</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>SIR(<span class="fl">0.009</span>, <span class="dv">0</span>, <span class="fl">0.04</span>, <span class="dv">70</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Third plot</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>SIR(<span class="fl">0.001</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="dv">70</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth plot</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>SIR(<span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="dv">70</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, use plt.show() to display all the plots at once in the Rmd file</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()  <span class="co"># Optional: this improves spacing between plots</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_10847/1260346731.py:3: DeprecationWarning: The catppuccin-matplotlib package is deprecated, please upgrade to https://github.com/catppuccin/python (pip install catppuccin)


  import mplcatppuccin</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-2-output-2.png" width="950" height="950" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="suar-model" class="level2">
<h2 class="anchored" data-anchor-id="suar-model">SUAR Model</h2>
<p>The SIR model fails to distinguish between different severities of addiction. By grouping the individuals who are trying/testing the drug with people who are addicted, we fail to capture the behavior of people trying the drug without becoming reliant on it. Because of this, we adapted the SIR model, relabeled the infected group to addicted, and added in a new compartment model for users of the drug who are not addicted, the ‘using’ group. Susceptible people will now move into the using group before moving into the Addicted group. Since there are now two groups who are using the drug and interacting with the community, the <span class="math inline">\(I\)</span> terms of the ODEs in the SIR model have to be replaced with <span class="math inline">\(U+A\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../post/drug-use-models/pics/2.png" class="img-fluid figure-img"></p>
<figcaption>SUAR Diagram</figcaption>
</figure>
</div>
<p>The new model can now be described by the following equations:</p>
<p><span class="math display">\[\frac{dS}{dt} = - \pi_1*S*(A+U) + \pi_2*U   \]</span> <span class="math display">\[\frac{dU}{dt} =  \pi_1*S*(A+U) - \pi_2*U  - \pi_3*U \]</span> <span class="math display">\[\frac{dA}{dt} = \pi_3*U +\pi_5 *(A+U)*R - \pi_4*A \]</span> <span class="math display">\[\frac{dR}{dt} =  \pi_4*A - \pi_5 *(A+U)*R \]</span></p>
<p>With parameters <span class="math inline">\(\pi_1\)</span>, <span class="math inline">\(\pi_2\)</span>, <span class="math inline">\(\pi_3\)</span>, <span class="math inline">\(\pi_4\)</span>, and <span class="math inline">\(\pi_5\)</span> being the ‘effectiveness’ of the drug for susceptible people, the rate that people stop trying the drug, the rate at which people become addicted, the recovery rate for addicted people respectively, and the ‘effectiveness’ for recovered people.</p>
<div id="95470d8d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new figure with a specified size</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Each subplot for SUAR function calls</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First SUAR plot</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>SUAR(<span class="fl">0.01</span>,<span class="fl">0.001</span>,<span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span> ,<span class="dv">60</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">100</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Second SUAR plot</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>SUAR(<span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span> ,<span class="dv">60</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">100</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Third SUAR plot</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>SUAR(<span class="fl">0.001</span>,<span class="fl">0.001</span>,<span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span> ,<span class="dv">60</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">100</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth SUAR plot</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>SUAR(<span class="fl">0.001</span>,<span class="fl">0.001</span>,<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span> ,<span class="dv">60</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">100</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Improve spacing between plots and show them all</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-3-output-1.png" width="1142" height="1142" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="saur-model-with-age" class="level2">
<h2 class="anchored" data-anchor-id="saur-model-with-age">SAUR Model with age</h2>
<p>Now focusing on the stationary points of the previous two models (see appendix for derivation), we realize that our long-term behavior involves the extinction of either the user and/or the addicted group. However, this behavior is unrealistic and rather too optimistic since there is a consistent number of people using and addicted to the drug, and a consistently high number of people who are susceptible to the drug. To fix this issue, we integrate age groups into the model, grouping the population into children, teens, young adults, adults, and seniors. Each of these groups has a distinct rate of death, and the births are proportional to the number of young adults and adults. Separating the population also allows us to set different parameters according to each age group, capturing more nuanced behaviors such as an increased volume of experimentation of young people which would not have been identified otherwise.</p>
<p>Another feature we wanted to tackle is how people recover. In the same way that people start using drugs based on interactions with others who are using them, we expect people to recover based on interactions with people who aren’t using them. This can be represented by support groups, concerned parents, friends, etc. Furthermore, we can expect people in one age group and compartment model to be influenced differently from each age group and subsequent compartment model. We can store this information with a matrix <span class="math inline">\(I\)</span>, where <span class="math inline">\(I_{ij}\)</span> is the magnitude of the influence that group j has on group i.</p>
<p>We can now go in to further simplify this by defining two new terms, the positive and negative influence on a age group <span class="math inline">\(i\)</span>, to be: <span class="math display">\[P_i = \sum{k=1}{5}{I_{ik} * (S_k + R_K)}\]</span> <span class="math display">\[N_i = \sum{k=1}{5}{I_{ik} * (U_k + A_K)}\]</span></p>
<p>The model now has 20 compartments with both sideways movement from and to age groups and downwards movement as people age.</p>
<p>Looking across age group ‘i’, the model can be described as:</p>
<p><span class="math display">\[\frac{dS_i}{dt} = aS_{i-1} + aU_{i-1} \pi_{i-1,2}P_{i-1} - S_i\pi_{i,1}N_i + (1-a)U_i\pi_{i,2}P_i - aSi - d_{i,s}S_i + (b\sum_{k=2}^{3}S_k+U_k+A_k+R_K | i = 0)  \]</span> <span class="math display">\[\frac{dU_i}{dt} =  aS_{i-1}\pi_{i-1,1}N_{i-1} + aU_{i-1} - U_i * \pi_{i,3} - a U_i - U_i\pi_{i,2}P_i + (1-a)S_i\pi_{i,1}N_i - d_{i,U}U_i\]</span> <span class="math display">\[\frac{dA_i}{dt} = aU_{i-1}\pi_{i-1,3} + aA_{i-1} + aR_{i-1}\pi_{i-1,5}N_{i-1} - A_i\pi_{i,4}P_i + (1-a)R_i\pi_{i,5}N_{i}-aA_i + (1-a)U_i\pi_{i,3}- d_{i,A}A_i\]</span> <span class="math display">\[\frac{dR_i}{dt} = aA_{i-1}\pi_{i-1,4}P_{i-1} + aR_{i-1} - aR_i -R_i\pi_{i,5}N_i + (1-a)A_i\pi_{i,4}P_i - d_{i,R}R_I \]</span></p>
<p>With the parameters being sorted in matrices <span class="math inline">\(\pi\)</span>, {d} and {i}, containing row-wise versions of the parameters for the SAUR model, the death rate for each compartment, and the influence that each age group has on the other, and scalars <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, which define the aging rate and the birth rate of the population.</p>
<div id="71423af7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>aging_rate <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>birth_rate <span class="op">=</span> <span class="fl">0.07</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>death_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">*</span>np.array([[<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>],</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>],</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                   [<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>],</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>               [<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>],</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>               [<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>]])</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>X0 <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> np.array([[<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                     [<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>             [<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">0</span>],</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>             [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>             [<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>(n_age_groups, n_status) <span class="op">=</span> np.shape(X0)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span>  <span class="fl">0.001</span><span class="op">*</span>np.array([[<span class="fl">0.1</span>, <span class="fl">0.0</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>],</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.0</span>],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>],</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>]])</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> <span class="fl">0.1</span><span class="op">*</span>np.array([[<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                  [<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span>],</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                  [<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.2</span>],</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                  [<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.1</span>],</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                  [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>]])</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>SUAR_20(aging_rate,birth_rate,death_rate, I, P, X0,<span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simplified-suar-model-with-age" class="level2">
<h2 class="anchored" data-anchor-id="simplified-suar-model-with-age">Simplified SUAR Model with age</h2>
<p>After creating the SAUR model with age groups, we experimented with various combinations of parameters to see how the model reacted. However, we found that with 20 compartments and 73 parameters, it is really hard to go through all the combinations to find meaningful results from the model. We could see that there were stationary points for the population portions, but finding them analytically was near impossible. Because of this, we sought to find a way to simplify the model to produce results that are easier to understand. We did this by removing the different age groups altogether, while keeping the equations describing the model the same. By removing the age groups, the equations dramatically simplify into this form;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../post/drug-use-models/pics/3.png" class="img-fluid figure-img"></p>
<figcaption>SUAR Diagram with ageing</figcaption>
</figure>
</div>
<p><span class="math display">\[\frac{dS}{dt} = -S\pi_{1}N +U\pi_2P  -d_SS + b(S+U+A+R)  \]</span> <span class="math display">\[\frac{dU}{dt} = S\pi_1N -U\pi_2P - U\pi_3 - d_UU  \]</span> <span class="math display">\[\frac{dA}{dt} = U\pi_3 - A\pi_4P + R\pi_5N - d_AA\]</span> <span class="math display">\[\frac{dR}{dt} = A\pi_4P - R\pi_5N - d_RR \]</span></p>
<div id="774c9d62" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The grid of subplots for the SUAR_5 function calls</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First SUAR_5 plot</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>SUAR_5(<span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, [<span class="fl">0.0001</span>, <span class="fl">0.0005</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>], <span class="dv">60</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Second SUAR_5 plot</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>SUAR_5(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, [<span class="fl">0.0001</span>, <span class="fl">0.0005</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>], <span class="dv">60</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Third SUAR_5 plot</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>SUAR_5(<span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, [<span class="fl">0.0001</span>, <span class="fl">0.0005</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>], <span class="dv">60</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth SUAR_5 plot</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>SUAR_5(<span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.001</span>, [<span class="fl">0.0001</span>, <span class="fl">0.0005</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>], <span class="dv">60</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">300</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout to prevent overlapping of subplots and then display all the plots</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-5-output-1.png" width="1142" height="1142" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looking at this model, it is clear to see that we will only find stationary points when births and deaths are equal. However we also want to see long term trends in growing and shrinking populations. To do this, we look at this model through population portions, redefining the system as:</p>
<p><span class="math display">\[ T = S + U + A + R \]</span> <span class="math display">\[ T' = b(S+U+A+R)  -d_SS -d_UU - d_AA - d_RR \]</span></p>
<p><span class="math display">\[ \frac{d\frac{S}{N}}{dt} = \frac{(-S\pi_{1}N +U\pi_2P  -d_SS + b(S+U+A+R))T-T'S}{T^2} \]</span> <span class="math display">\[ \frac{d\frac{U}{N}}{dt} = \frac{(S\pi_1N -U\pi_2P - U\pi_3 - d_UU )T-T'U}{T^2} \]</span> <span class="math display">\[ \frac{d\frac{A}{N}}{dt} = \frac{(U\pi_3 - A\pi_4P + R\pi_5N - d_AA)T-T'A}{T^2}  \]</span> <span class="math display">\[ \frac{d\frac{R}{N}}{dt} = \frac{(A\pi_4P - R\pi_5N - d_RR )T-T'R}{T^2} \]</span></p>
<p>Denoting these fractions as s,u,a,r and reformatting the equation using T as a characteristic for population and <span class="math inline">\(\frac{1}{b}\)</span> as a characteristic for time;</p>
<p><span class="math display">\[ s+u+a+r = 1\]</span> <span class="math display">\[ \frac{ds}{dt} = (-s\pi_{1}(u+a)+u\pi_2(s+r)  -d_Ss + 1)-s(1 - d_Ss - d_Uu - d_Aa - d_Rr) \]</span> <span class="math display">\[ \frac{du}{dt} = (s\pi_{1}(u+a)-u\pi_2(s+r) - u\pi_3 -d_Uu )-u(1 - d_Ss - d_Uu - d_Aa - d_Rr) \]</span> <span class="math display">\[ \frac{da}{dt} = (u\pi_3 -a\pi_4(s+r) + r\pi_5(u+a) -d_Aa )-a(1 - d_Ss - d_Uu - d_Aa - d_Rr)  \]</span> <span class="math display">\[ \frac{dr}{dt} = (a\pi_4(s+r) - r\pi_5(u+a) -d_Rr )-r(1 - d_Ss - d_Uu - d_Aa - d_Rr)\]</span></p>
<div id="226c3456" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a new plot with a specific figure size</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the SUAR_norm function calls in a 2x2 subplot grid</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1 in the top-left position (1st row, 1st column)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>SUAR_norm(<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,[<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.1</span>],<span class="fl">0.6</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">50</span>,<span class="fl">0.1</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2 in the top-right position (1st row, 2nd column)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>SUAR_norm(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,[<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.1</span>],<span class="fl">0.6</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">50</span>,<span class="fl">0.1</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3 in the bottom-left position (2nd row, 1st column)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>SUAR_norm(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">1</span>,[<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.1</span>],<span class="fl">0.6</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">50</span>,<span class="fl">0.1</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 4 in the bottom-right position (2nd row, 2nd column)</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>SUAR_norm(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,[<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.1</span>],<span class="fl">0.6</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">50</span>,<span class="fl">0.1</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Improve the spacing between the plots</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, show all the plots</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-6-output-1.png" width="1142" height="1142" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>We can think of deaths as a movement from all compartments to the susceptible compartments. This makes it clear that a stationary point exists when all the people are in the susceptible compartment, meaning the drug is ‘extinct’. Similarly, the drug is also extinct when everyone is either in the recovered or susceptible group, as one just has to wait for the recovered people to die for the portion of S to reach 1. These two facts can be seen in appendix 3. Let the stationary point at <span class="math inline">\(s=1\)</span> be the trivial stationary point.</p>
<p>However, for some combinations of parameters, secondary stationary points are found. These non-trivial stationary points could not be found analytically using MATLAB 2021b, therefore their existence must be verified on a case-by-case basis, using the code in appendix 4. Note that all the death parameters were set to one, meaning that these results are for drugs where the rate of death is independent of the compartment. To find results for other sets of death parameters, line 25 of appendix 4 should be altered.</p>
<p>Using the table of non-trivial stationary points (appendix 10), we can now plot the number of combinations of parameters that lead to non-trivial stationary points pairwise by parameter.</p>
<div id="5e0a1e6e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mplcatppuccin.colormaps <span class="im">import</span> get_colormap_from_list</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> get_colormap_from_list(<span class="st">"mocha"</span>, [<span class="st">"red"</span>, <span class="st">"peach"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> pd.read_csv(<span class="st">'ss.csv'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>use <span class="op">=</span>  pd.read_csv(<span class="st">'avg.csv'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>res.columns <span class="op">=</span> [<span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>, <span class="st">'extinct'</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>use.columns <span class="op">=</span>  [ <span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>, <span class="st">'p_using'</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> [<span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>xlabels <span class="op">=</span> [<span class="st">'-3'</span>,<span class="st">'-2'</span>,<span class="st">'-1'</span>,<span class="st">'0'</span>,<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, a <span class="kw">in</span> <span class="bu">enumerate</span>(p):</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, b <span class="kw">in</span> <span class="bu">enumerate</span>(p):</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">!=</span> j:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            w <span class="op">=</span> res[[a, b, <span class="st">'extinct'</span>]].groupby([a, b]).<span class="bu">sum</span>().unstack()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> axs[i, j].pcolormesh(w, cmap<span class="op">=</span>cmap, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">216</span>)  <span class="co"># Here is the change</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_xticks(np.arange(<span class="dv">7</span>) <span class="op">+</span> <span class="fl">0.5</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_xticklabels(xlabels, fontdict<span class="op">=</span><span class="va">None</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_xlabel(<span class="st">'Log2('</span> <span class="op">+</span> b <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            axs[i, j].get_xaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> j <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_yticks(np.arange(<span class="dv">7</span>) <span class="op">+</span> <span class="fl">0.5</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_yticklabels(xlabels, fontdict<span class="op">=</span><span class="va">None</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            axs[i, j].set_ylabel(<span class="st">'Log2('</span> <span class="op">+</span> a <span class="op">+</span> <span class="st">')'</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            axs[i, j].get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>cbar_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.85</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>])</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> fig.colorbar(t, cax<span class="op">=</span>cbar_ax)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Number of combinations that have Non-trivial stationary points </span><span class="ch">\n</span><span class="st"> ds=1, du=1, da=1, dr=1 s0=0.6, u0=0.2, a0=0.1, r0=0.1, Total Sims = 216"</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-7-output-1.png" width="636" height="477" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From this plot, one can see a big factor that influences the creation of these non-trivial stationary points is the magnitude of <span class="math inline">\(\pi_1\)</span>, and to a lesser extent the ratio of <span class="math inline">\(\pi_1\)</span> and <span class="math inline">\(\pi_2\)</span>. In this case, births will rapidly transition to the using category, meaning that they then have the potential to become addicted.</p>
<p>Another result one can take from the data is the number of people who are using or addicted to the drug at the pseudo-stationary points, as shown in the plots below.</p>
<div id="1152e304" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i , a <span class="kw">in</span> <span class="bu">enumerate</span>( p):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j , b <span class="kw">in</span> <span class="bu">enumerate</span>(p):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">!=</span>j:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            w <span class="op">=</span> use[[a,b,<span class="st">'p_using'</span>]].groupby([a,b]).mean()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            dk <span class="op">=</span> pd.DataFrame(np.nan, columns<span class="op">=</span>xlabels, index<span class="op">=</span>xlabels)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> l <span class="kw">in</span> xlabels:</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> m <span class="kw">in</span> xlabels:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                        dk[m][l] <span class="op">=</span> w.loc[(<span class="bu">int</span>(l), <span class="bu">int</span>(m))]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">pass</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> axs[i, j].pcolormesh(w, cmap<span class="op">=</span>cmap, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Here is the change</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_xticks(np.arange(<span class="dv">7</span>) <span class="op">+</span> <span class="fl">0.5</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_xticklabels(xlabels, fontdict<span class="op">=</span><span class="va">None</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_xlabel(<span class="st">'Log2('</span> <span class="op">+</span> b <span class="op">+</span><span class="st">')'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            axs[i,j].get_xaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> j <span class="op">==</span> <span class="dv">0</span> :</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_yticks(np.arange(<span class="dv">7</span>) <span class="op">+</span> <span class="fl">0.5</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_yticklabels(xlabels, fontdict<span class="op">=</span><span class="va">None</span>, minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            axs[i,j].set_ylabel(<span class="st">'Log2('</span> <span class="op">+</span> a <span class="op">+</span><span class="st">')'</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            axs[i,j].get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>fig.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>cbar_ax <span class="op">=</span> fig.add_axes([<span class="fl">0.85</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>])</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> fig.colorbar(t, cax<span class="op">=</span>cbar_ax)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Average portion of people using or addicted at non-Trivial Stationary Points </span><span class="ch">\n</span><span class="st"> ds=1, du=1, da=1, dr=1 s0=0.6, u0=0.2, a0=0.1, r0=0.1, Total Sims = 216"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  dk[m][l] = w.loc[(int(l), int(m))]
/tmp/ipykernel_10847/3641793569.py:10: FutureWarning: Calling float on a single element Series is deprecated and will raise a TypeError in the future. Use float(ser.iloc[0]) instead
  dk[m][l] = w.loc[(int(l), int(m))]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_report_files/figure-html/cell-8-output-2.png" width="636" height="477" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looking at these plots we can see the following behaviors:</p>
<ul>
<li>Bigger <span class="math inline">\(\pi_1\)</span> <span class="math inline">\(\to\)</span> Higher Mean</li>
<li>Bigger <span class="math inline">\(\pi_2\)</span> <span class="math inline">\(\to\)</span> Lower Mean</li>
<li>Bigger <span class="math inline">\(\pi_3\)</span> <span class="math inline">\(\to\)</span> Lower Mean</li>
<li>Bigger <span class="math inline">\(\pi_4\)</span> <span class="math inline">\(\to\)</span> Lower Mean</li>
<li>Bigger <span class="math inline">\(\pi_5\)</span> <span class="math inline">\(\to\)</span> Higher Mean</li>
</ul>
<p>Therefore, in terms of the long-term state of drug use in communities, the best way to minimize drug use is to minimize <span class="math inline">\(\pi_1\)</span> such that the drug becomes extinct. If this cannot be done, the number of people using or addicted to drugs can be minimized by lowering the values of <span class="math inline">\(\pi_2, \pi_3, \pi_4\)</span> or maximizing the value of <span class="math inline">\(\pi_5\)</span> to make the stationary point have a minimal number of people using the drug.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>Contrasting the simplified SUAR model with Nyabadza et al (2016) on crystal meth use in South Africa, the forcing parameter for a susceptible individual to transfer out of their compartment was a weighted sum of U and A rather than the sum scaled, furthermore, there was a forcing parameter dependent on the size of the drug supply chain.</p>
<p>Another downside of our model is the fact that we have not focused on one specific substance and rather decided to adopt a more general approach to the problem. When focusing on one substance and/or a “family” of substances such as in the paper by Mushanyu, J, Nyabadza, F, &amp; Stewart, A G R. (2015) we can narrow down our results and get more specific and detailed answers.</p>
<p>A question posed by the model is how we arrive at the various states that we see at t = 0. For non-illicit drugs like cigarettes and alcohol, marketing strategies from distributors like television ads, billboards etc. can persuade susceptible members to initiate. We suggest the forcing parameter to be a function of the industry’s market cap. Australia has plain packaging laws to dampen the forcing parameter. For illicit drugs, the supply of the drug depends on network effects. Online drug markets like The Silk Road can be assumed to have no interaction with non-users. Its only effect is to the accessibility of drugs for people in compartments U and A. Adding in forcing functions into the model, and/or allowing the parameters to change as a function of time will allow for these events to be modeled.</p>
<p>Regarding the findings of the model, the way parameters are altered to change when the trivial stationary point is found, or the level of drug use in a nontrivial stationary point seem in line with common policies targeting drug minimization. By lowering the amount of people who start using the drug, such as Australia’s ban on cigarette marketing. More generally, the results show that the best way to reduce drug use is to minimize the net movement from susceptible to using and recovered to addicted.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The aim of this project was to model the long-term outcomes of drug use in a community. Four models were developed: the initial SIR model, a modified SUAR model, the SUAR model with age-structure, then the simplified SUAR model with age. For the closed population models, the simulations had one of two outcomes: no drug users or entirely drug users. When births and deaths are accounted for, the population can have endemic proportions of susceptible, using, addicted, and recovered members. We found ways to push drug use to extinction by manipulating the transmission parameters.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li>Mushanyu, J, Nyabadza, F, Muchatibaya, G, &amp; Stewart, A G. R. (2016). Modelling Drug Abuse Epidemics in the Presence of Limited Rehabilitation Capacity. Bulletin of Mathematical Biology, 78(12), 2364-2389. https://doi.org/10.1007/s11538-016-0218-5</li>
<li>Mushanyu, J, Nyabadza, F, &amp; Stewart, A G R. (2015). Modelling the trends of inpatient and outpatient rehabilitation for methamphetamine in the Western Cape province of South Africa. BMC Research Notes, 8(796), 797-797. https://doi.org/10.1186/s13104-015-1741-4</li>
<li>Betterhealth.vic.gov.au. 2021. Drug use in Victoria - Better Health Channel. [online] Available at: <a href="https://www.betterhealth.vic.gov.au/health/healthyliving/drug-use-in-victoria" class="uri">https://www.betterhealth.vic.gov.au/health/healthyliving/drug-use-in-victoria</a> [Accessed 21 October 2021].</li>
<li>Thedoctors.com. 2021. U.S. Surgeon General Discusses the Opioid Epidemic. [online] Available at: <a href="https://www.thedoctors.com/articles/u.s.-surgeon-general-discusses-the-opioid-epidemic/" class="uri">https://www.thedoctors.com/articles/u.s.-surgeon-general-discusses-the-opioid-epidemic/</a> [Accessed 21 October 2021].</li>
<li>Caulkins, Jonathan P, Dietze, Paul, &amp; Ritter, Alison. (2007). Dynamic compartmental model of trends in Australian drug use. Health Care Management Science, 10(2), 151-162. https://doi.org/10.1007/s10729-007-9012-0</li>
<li>Harvim, P., Zhang, H., Georgescu, P., &amp; Zhang, L. (2021). Cigarette smoking on college campuses: An epidemical modelling approach. Journal of Applied Mathematics and Computing, 65(1), 515-540. https://doi.org/10.1007/s12190-020-01402-y</li>
<li>Nyabadza, F., Njagarah, J. B. H., &amp; Smith, R. J. (2013). Modelling the Dynamics of Crystal Meth (‘Tik’) Abuse in the Presence of Drug-Supply Chains in South Africa. Bulletin of Mathematical Biology, 75(1), 24-48. https://doi.org/10.1007/s11538-012-9790-5</li>
</ol>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="appendix-1-stationary-points-of-sir-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-1-stationary-points-of-sir-model">Appendix 1 : Stationary points of SIR model</h2>
<p><span class="math display">\[0 = -\pi_1 * S * I \]</span> <span class="math display">\[0 = \pi_1 * S * I + \pi_2 * R * I - \pi_3 *  I \]</span> <span class="math display">\[0 = -\pi_2 * R * I + \pi_3 * I \]</span></p>
<p>Therefore either <span class="math inline">\(\pi_1\)</span>, <span class="math inline">\(S\)</span> or <span class="math inline">\(I\)</span> must be 0</p>
<p>If <span class="math inline">\(I = 0\)</span>:</p>
<p><span class="math display">\[0 = -\pi_1 * S * 0 \]</span> <span class="math display">\[0 = \pi_1 * S * 0 + \pi_2 * R * 0 - \pi_3 *  0 \]</span> <span class="math display">\[0 = -\pi_2 * R * 0 + \pi_3 * 0 \]</span></p>
<p>Therefore any point [<span class="math inline">\(S\)</span>,0,<span class="math inline">\(R\)</span>] is stationary.</p>
<p>If <span class="math inline">\(\pi_1 = 0\)</span> or <span class="math inline">\(S=0\)</span>:</p>
<p><span class="math display">\[0 =  0 * I \]</span> <span class="math display">\[0 = 0 * I + \pi_2 * R * I - \pi_3 *  I \]</span> <span class="math display">\[0 = -\pi_2 * R * I + \pi_3 * I \]</span></p>
<p>Therefore:</p>
<p><span class="math display">\[ \pi_2 * R * I - \pi_3 *  I = - \pi_2 * R * I + \pi_3 *  I  \]</span> <span class="math display">\[ \pi_2 * R * I = \pi_3 * I \]</span> <span class="math display">\[ R:I = \pi_3:\pi_2 \]</span></p>
<p>Therefore any point [0, <span class="math inline">\(\frac {P_{total}*\pi_2}{\pi_2 + \pi_3}\)</span> ,<span class="math inline">\(\frac {P_{total}*\pi_3}{\pi_2 + \pi_3}\)</span>]</p>
</section>
<section id="appendix-2-stationary-points-of-suar" class="level2">
<h2 class="anchored" data-anchor-id="appendix-2-stationary-points-of-suar">Appendix 2 : Stationary points of SUAR</h2>
<p><span class="math display">\[0 = - \pi_1*S*(A+U) + \pi_2*U   \]</span> <span class="math display">\[0 =  \pi_1*S*(A+U) - \pi_2*U  - \pi_3*U \]</span> <span class="math display">\[0 = \pi_3*U +\pi_4 *(A+U)*R - \pi_5*A \]</span> <span class="math display">\[0 =  \pi_5*A - \pi_4 *(A+U)*R \]</span></p>
<p>By combing the first two and last two equations, one can see that if the parameters are non 0, <span class="math inline">\(U=0\)</span>. Therefore:</p>
<p><span class="math display">\[ 0 = \pi_1*S*A \]</span> <span class="math display">\[0 = \pi_4 *A*R - \pi_5*A \]</span> <span class="math display">\[0 =  \pi_5*A - \pi_4 *A*R \]</span></p>
<p>Therefore <span class="math inline">\(S = 0\)</span> or <span class="math inline">\(A = 0\)</span> In the case <span class="math inline">\(A = 0\)</span>, any point [<span class="math inline">\(S\)</span>,0,0,<span class="math inline">\(R\)</span>] will be stationary</p>
<p>In the case <span class="math inline">\(S=0\)</span> <span class="math display">\[ \pi_4*A*R = \pi_5*A\]</span> <span class="math display">\[R:A = \pi_5:\pi_4\]</span></p>
<p>Therefore any point [0,0, <span class="math inline">\(\frac {P_{total}*\pi_4}{\pi_4 + \pi_5}\)</span> ,<span class="math inline">\(\frac {P_{total}*\pi_5}{\pi_4 + \pi_5}\)</span>]</p>
</section>
<section id="appendix-3-critical-points-of-simplified-suar-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-3-critical-points-of-simplified-suar-model">Appendix 3: Critical Points of Simplified SUAR model</h2>
<p>When s = 1: <span class="math display">\[ s = 1\]</span> <span class="math display">\[ \frac{ds}{dt} = (-d_Ss + 1)-s(1 - d_Ss) = (1-S)(1-d_Ss)  = 0 \]</span> <span class="math display">\[ \frac{du}{dt} = 0 \]</span> <span class="math display">\[ \frac{da}{dt} = 0  \]</span> <span class="math display">\[ \frac{dr}{dt} = 0  \]</span></p>
<p>When s+r = 1: <span class="math display">\[ s+r = 1\]</span> <span class="math display">\[ s = 1 - r \]</span></p>
<p><span class="math display">\[ \frac{ds}{dt} = (-d_Ss + b)-s(1 - d_Ss - d_Rr)  = (1 -s)*(1 + d_r*s - d_s*s)\]</span> <span class="math display">\[ \frac{du}{dt} = 0 \]</span> <span class="math display">\[ \frac{da}{dt} = 0  \]</span> <span class="math display">\[ \frac{dr}{dt} = (-d_Rr )-r(1 - d_Ss - d_Rr) = (s - 1)*(1 + d_r*s - d_s*s)\]</span></p>
</section>
<section id="appendix-4-matlab-code-for-generating-conditional-stationary-points" class="level2">
<h2 class="anchored" data-anchor-id="appendix-4-matlab-code-for-generating-conditional-stationary-points">Appendix 4: Matlab code for generating conditional Stationary Points</h2>
<p>```{octave, eval = FALSE} syms s u a r p1 p2 p3 p4 p5 ds du da dr</p>
<p>ode1 = (-s<em>p1</em>(u+a)+u<em>p2</em>(s+r) -ds<em>s + 1)-s </em>(1 - ds<em>s - du</em>u - da<em>a - dr</em>r); ode2 = (s<em>p1</em>(u+a)-u<em>p2</em>(s+r) - u<em>p3 -du</em>u )-u<em>(1 - ds</em>s - du<em>u - da</em>a - dr<em>r) ; ode3 = (u</em>p3 -a<em>p4</em>(s+r) + r<em>p5</em>(u+a) -da<em>a )-a</em>(1 - ds<em>s - du</em>u - da<em>a - dr</em>r); ode4 = (a<em>p4</em>(s+r) - r<em>p5</em>(u+a) -dr<em>r )-r</em>(1 - ds<em>s -du</em>u - da<em>a - dr</em>r); sums = s+u+a+r;</p>
<p>odes = [ode1 == 0, ode2 == 0, ode3 == 0 , ode4 == 0, sums == 1, s&gt;=0, u &gt;= 0, a &gt;=0, r&gt;=0];</p>
<p>ss = []; avg = [];</p>
<p>k = 3;</p>
<p>for p1i = -k:k for p2i = -k:k for p3i = -k:k for p4i = -k:k for p5i = -k:k [p1, p2, p3, p4, p5, ds, du, da, dr] = deal(2^p1i, 2^p2i, 2^p3i, 2^p4i, 2^p5i,1,1,1,1); sol = solve(subs(odes),‘Real’,true); ss = [ss ; [p1i,p2i,p3i,p4i,p5i,length(sol.s) - 1]]; if length(sol.s) &gt; 1 avg = [avg ; [p1i,p2i,p3i,p4i,p5i,mean(sol.u(2:length(sol.u)) + sol.a(2:length(sol.a)))]]; end;end;end;end;end;end</p>
<p>writematrix(double(avg),‘avg.csv’) writematrix(double(ss), ‘ss.csv’)</p>
<pre><code>


## Appendix 5: Python code for simulating SIR model

::: {#b861eef5 .cell execution_count=8}
``` {.python .cell-code}
from inspect import getsource as gs
print(gs(SIR))
</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code>def SIR(p1, p2, p3, S0, I0, R0, i):
    vect_initial = np.array([S0, I0, R0]).T

    output = pd.DataFrame(columns=["day", "S", "I", "R"])
    j = 0
    vect = vect_initial.copy()

    while j &lt; i:
        vectplus1 = np.zeros([3])
        S = vect[0]
        I = vect[1]
        R = vect[2]
        vectplus1[0] = S - p1 * S * I
        vectplus1[1] = I + p1 * S * I + p2 * R * I - p3 * I
        vectplus1[2] = R - p2 * R * I + p3 * I
        output.loc[j] = np.concatenate((np.array([j]), vectplus1.T))
        vect = vectplus1.copy()
        j += 1

    plt.plot(output["day"], output["S"])
    plt.plot(output["day"], output["I"])
    plt.plot(output["day"], output["R"])
    plt.title("p1=" + str(p1) + ", p2=" + str(p2) + ", p3=" + str(p3))
    plt.legend(["S", "I", "R"])
</code></pre>
</div>
<p>:::</p>
</section>
<section id="appendix-6-python-code-for-simulating-suar-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-6-python-code-for-simulating-suar-model">Appendix 6: Python code for simulating SUAR model</h2>
<div id="5c31ffd8" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect <span class="im">import</span> getsource <span class="im">as</span> gs</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs(SUAR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def SUAR(p1, p2, p3, p4, p5, S0, U0, A0, R0, i):
    vect_initial = np.array([S0, U0, A0, R0]).T

    output = pd.DataFrame(columns=["day", "S", "U", "A", "R"])
    j = 0
    vect = vect_initial.copy()

    while j &lt; i:
        vectplus1 = np.zeros([4])
        S = vect[0]
        U = vect[1]
        A = vect[2]
        R = vect[3]
        vectplus1[0] = S - p1 * S * (A + U) + p2 * U
        vectplus1[1] = U + p1 * S * (A + U) - p2 * U - p3 * U
        vectplus1[2] = A + p3 * U + p5 * (A + U) * R - p4 * A
        vectplus1[3] = R + p4 * A - p5 * (A + U) * R
        output.loc[j] = np.concatenate((np.array([j]), vectplus1.T))
        vect = vectplus1.copy()
        j += 1

    plt.plot(output["day"], output["S"])
    plt.plot(output["day"], output["U"])
    plt.plot(output["day"], output["A"])
    plt.plot(output["day"], output["R"])
    plt.title(
        "p1="
        + str(p1)
        + ", p2="
        + str(p2)
        + ", p3="
        + str(p3)
        + ", p4="
        + str(p4)
        + ", p5="
        + str(p5)
    )
    plt.legend(["S", "U", "A", "R"])
</code></pre>
</div>
</div>
</section>
<section id="appendix-7-python-code-for-simulating-20-compartment-suar-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-7-python-code-for-simulating-20-compartment-suar-model">Appendix 7: Python code for simulating 20 compartment SUAR model</h2>
<div id="133e66ec" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect <span class="im">import</span> getsource <span class="im">as</span> gs</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs(SUAR_20))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def SUAR_20(aging_rate, birth_rate, death_rate, I, P, X0, steps):
    C = pd.DataFrame(columns=["s", "t", "a", "r"], dtype="float128")
    T = pd.DataFrame(columns=["s", "t", "a", "r"], dtype="float128")
    Y = pd.DataFrame(columns=["s", "t", "a", "r"], dtype="float128")
    A = pd.DataFrame(columns=["s", "t", "a", "r"], dtype="float128")
    S = pd.DataFrame(columns=["s", "t", "a", "r"], dtype="float128")

    (n_age_groups, n_status) = np.shape(X0)
    itterations = 0
    while itterations &lt; steps:
        C.loc[itterations] = X0[0]
        T.loc[itterations] = X0[1]
        Y.loc[itterations] = X0[2]
        A.loc[itterations] = X0[3]
        S.loc[itterations] = X0[4]

        i = 0

        IE = np.matmul(I, X0)

        Xn = np.zeros(np.shape(X0))

        while i &lt; n_age_groups:
            group_vect = X0[i].copy()
            s = group_vect[0]
            t = group_vect[1]
            a = group_vect[2]
            r = group_vect[3]
            interaction_neg = np.sum(IE[i][[1, 2]])
            interaction_pos = np.sum(IE[i][[0, 3]])

            Xn[i][0] = (
                s - (s * P[i][0] * interaction_neg) + t * P[i][1] * interaction_pos
            )
            Xn[i][1] = (
                t
                + (s * P[i][0] * interaction_neg)
                - t * P[i][1] * interaction_pos
                - t * P[i][2]
            )
            Xn[i][2] = (
                a
                + t * P[i][2]
                + r * P[i][4] * interaction_neg
                - a * P[i][3] * interaction_pos
            )
            Xn[i][3] = r - r * P[i][4] * interaction_neg + a * P[i][3] * interaction_pos

            i += 1

        Xn_aged = np.zeros(np.shape(X0))

        i = 0
        j = 0

        while i &lt; n_age_groups:
            j = 0
            while j &lt; n_status:
                if i == 0:
                    if j == 0:
                        Xn_aged[i][j] = Xn[i][j] * (
                            1 - aging_rate - death_rate[i][j]
                        ) + birth_rate * sum(Xn[2] + Xn[3])
                j += 1
            i += 1

        itterations += 1
</code></pre>
</div>
</div>
</section>
<section id="appendix-8-python-code-for-simulating-5-compartment-suar-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-8-python-code-for-simulating-5-compartment-suar-model">Appendix 8: Python code for simulating 5 compartment SUAR model</h2>
<div id="79247f0c" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect <span class="im">import</span> getsource <span class="im">as</span> gs</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs(SUAR_5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def SUAR_5(p1, p2, p3, p4, p5, b, d, S0, U0, A0, R0, i):
    vect_initial = np.array([S0, U0, A0, R0]).T

    output = pd.DataFrame(columns=["day", "S", "U", "A", "R"])
    j = 0
    vect = vect_initial.copy()

    while j &lt; i:
        vectplus1 = np.zeros([4])
        S = vect[0]
        U = vect[1]
        A = vect[2]
        R = vect[3]
        vectplus1[0] = (
            S - p1 * S * (A + U) + p2 * U * (S + R) - d[0] * S + b * (S + U + A + R)
        )
        vectplus1[1] = U + p1 * S * (A + U) - p2 * U * (S + R) - p3 * U - d[1] * U
        vectplus1[2] = A + p3 * U + p5 * (A + U) * R - p4 * A * (R + S) - d[2] * A
        vectplus1[3] = R + p4 * A * (S + R) - p5 * (A + U) * R - d[3] * R

        output.loc[j] = np.concatenate((np.array([j]), vectplus1.T))
        vect = vectplus1.copy()
        j += 1

    output["pop"] = output["S"] + output["U"] + output["A"] + output["R"]
    plt.plot(output["day"], output["S"] / output["pop"])
    plt.plot(output["day"], output["U"] / output["pop"])
    plt.plot(output["day"], output["A"] / output["pop"])
    plt.plot(output["day"], output["R"] / output["pop"])
    plt.title(
        "Portion: p1="
        + str(p1)
        + ", p2="
        + str(p2)
        + ", p3="
        + str(p3)
        + ", p4="
        + str(p4)
        + ", p5="
        + str(p5)
    )
    plt.legend(["S", "U", "A", "R"])
</code></pre>
</div>
</div>
</section>
<section id="appendix-9-python-code-for-simulating-5-compartment-dimensionless-suar-model" class="level2">
<h2 class="anchored" data-anchor-id="appendix-9-python-code-for-simulating-5-compartment-dimensionless-suar-model">Appendix 9: Python code for simulating 5 compartment dimensionless SUAR model</h2>
<div id="10e7da23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect <span class="im">import</span> getsource <span class="im">as</span> gs</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs(SUAR_norm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def SUAR_norm(p1, p2, p3, p4, p5, d, S0, U0, A0, R0, i, h, plot=True):
    vect_initial = np.array([S0, U0, A0, R0]).T

    output = pd.DataFrame(columns=["day", "s", "u", "a", "r"])
    j = 0
    vect = vect_initial.copy()

    ds = d[0]
    du = d[1]
    da = d[2]
    dr = d[3]

    while j &lt; i:
        vectplus1 = np.zeros([4])
        s = vect[0]
        u = vect[1]
        a = vect[2]
        r = vect[3]
        vectplus1[0] = s + h * (
            (-s * p1 * (u + a) + u * p2 * (s + r) - ds * s + 1)
            - s * (1 - ds * s - du * u - da * a - dr * r)
        )
        vectplus1[1] = u + h * (
            (s * p1 * (u + a) - u * p2 * (s + r) - u * p3 - du * u)
            - u * (1 - ds * s - du * u - da * a - dr * r)
        )
        vectplus1[2] = a + h * (
            (u * p3 - a * p4 * (s + r) + r * p5 * (u + a) - da * a)
            - a * (1 - ds * s - du * u - da * a - dr * r)
        )
        vectplus1[3] = r + h * (
            (a * p4 * (s + r) - r * p5 * (u + a) - dr * r)
            - r * (1 - ds * s - du * u - da * a - dr * r)
        )
        output.loc[j] = np.concatenate((np.array([j * h]), vectplus1.T))
        vect = vectplus1.copy()
        j += 1
    if plot:
        plt.plot(output["day"], output["s"])
        plt.plot(output["day"], output["u"])
        plt.plot(output["day"], output["a"])
        plt.plot(output["day"], output["r"])
        plt.title(
            "Portion: p1="
            + str(p1)
            + ", p2="
            + str(p2)
            + ", p3="
            + str(p3)
            + ", p4="
            + str(p4)
            + ", p5="
            + str(p5)
        )
        plt.legend(["S", "U", "A", "R"])
        return
    else:
        return [s, u, a, r]
</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
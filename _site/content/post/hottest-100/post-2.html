<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alfie Chadwick">
<meta name="dcterms.date" content="2024-02-03">

<title>A Follow Up on my Hottest 100 Predictions – Alfie Chadwick</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-0bfc47cc6585117dad3fa173ac69ce0a.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-57f0a2175cf6b1e1e8dfcb2d4390484b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Alfie Chadwick</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../content/index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../content/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#top-20" id="toc-top-20" class="nav-link active" data-scroll-target="#top-20">Top 20</a></li>
  <li><a href="#snubbed-songs" id="toc-snubbed-songs" class="nav-link" data-scroll-target="#snubbed-songs">Snubbed Songs</a></li>
  <li><a href="#surprise-songs" id="toc-surprise-songs" class="nav-link" data-scroll-target="#surprise-songs">Surprise Songs</a></li>
  <li><a href="#did-i-do-better-than-warm-tuna" id="toc-did-i-do-better-than-warm-tuna" class="nav-link" data-scroll-target="#did-i-do-better-than-warm-tuna">Did I do better than Warm Tuna?</a></li>
  <li><a href="#next-year" id="toc-next-year" class="nav-link" data-scroll-target="#next-year">Next Year?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Follow Up on my Hottest 100 Predictions</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alfie Chadwick </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>In my <a href="../../../2024/01/26/predicting-the-2023-hottest-100/">last post</a> I ended by planting my flag and making my predictions for the Hottest 100 for 2023. And on first glance, I’m pretty happy with myself, picking not only the top song, but a good chunk of the top 20. So today I just want to do a quick follow up on how I did.</p>
<section id="top-20" class="level1">
<h1>Top 20</h1>
<pre><code>                     Song         Artist Predicted
1      paint the town red       doja cat         1
2  the worst person alive         g flip        55
3               saving up      dom dolla        NA
4              rhyme dust             mk        72
5                   prada           cass        90
6                 adore u     fred again        40
7    what was i made for?  billie eilish         3
8                    rush    troye sivan        10
9             lovin on me    jack harlow        17
10               chemical    post malone        14
11                vampire olivia rodrigo         2
12                 rumble       skrillex        NA
13              kill bill            sza         9
14             atmosphere         fisher        NA
15                 nanana      peggy gou         5
16               sprinter           dave         4
17             back on 74         jungle        NA
18           eat your man      dom dolla        NA
19                therapy       budjerah        NA
20          sorry instead    spacey jane        NA</code></pre>
<p>The top 10 seems okay, but i did miss a lot of the top 20 completely. I seemed to be undervaluing Australian artists such as Dom Dolla, Spacey Jane, and G Flip, as well as EDM as a genre, which made up a much greater portion of the top 20 than I predicted.</p>
</section>
<section id="snubbed-songs" class="level1">
<h1>Snubbed Songs</h1>
<pre><code>                      Song                Artist Predicted
1                love type              poolclvb         6
2                super ego          babe rainbow         8
3                   adored            royel otis        15
4         lost without you             san cisco        21
5             super-vision                  dice        22
6             blak britney          miss kaninna        24
7                 ruthless         hooligan hefs        26
8                attention              doja cat        27
9               james dean          tash sultana        28
10             do it again                 benee        33
11        i wish you roses            kali uchis        35
12           dash of speed            rum jungle        36
13                too much         the kid laroi        37
14              eyes ahead                  dice        38
15          pets and drugs            the rubens        42
16          into your room     holly humberstone        44
17                      up                   lee        46
18                 pegasus            arlo parks        47
19               exploding         angie mcmahon        48
20                 calling          metro boomin        50
21            must be nice                  ruel        51
22             better love            eliza rose        52
23            your funeral                  maya        53
24       don't let me down         gus dapperton        54
25               conceited            lola young        56
26               messed up             holy holy        57
27        lost in the rush              telenova        58
28            candle flame                jungle        59
29            prescription             remi wolf        63
30                  change                laurel        64
31                   angel        pinkpantheress        65
32                  sinner the last dinner party        66
33                 midwest             vacations        67
34             pretty girl             ice spice        68
35           i wanna dance            royel otis        71
36       make up your mind                cordae        74
37              viper room             thornhill        75
38              weightless            arlo parks        76
39       can't play myself                skepta        78
40          black mascara.                  raye        79
41              feel alive                   cat        80
42                tied up!         genesis owusu        81
43          mrs. hollywood                  gojo        84
44           am i dreaming          metro boomin        85
45                 comma's               onefour        86
46                    lola                  maya        87
47 it's cool to be in love         greta stanley        88
48    since i have a lover                 6lack        89
49           lil boo thang          paul russell        91
50            going kokomo            royel otis        93
51             all my life              lil durk        94
52            brain freeze northeast party house        95
53                 healing      molly millington        96
54                  sticky                  kito        97
55                  rakata     the jungle giants        98</code></pre>
<p>So there were 55 songs in my predictions that didn’t make it into the countdown, including 3 of my top 20. Funily enough though, a lot of my predictions seemed to line up with peoples opions online with <a href="https://www.reddit.com/r/triplej/comments/1adh146/comment/kk1b24c/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Love Type</a>, <a href="https://www.reddit.com/r/triplej/comments/1adh146/comment/kk16o08/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Super Ego</a> and <a href="https://www.reddit.com/r/triplej/comments/1adh146/comment/kk1hqcl/?utm_source=share&amp;utm_medium=web2x&amp;context=3">Adored</a> all being mentioned as snubs from the hottest 100.</p>
</section>
<section id="surprise-songs" class="level1">
<h1>Surprise Songs</h1>
<pre><code>                   Song               Artist rank
1             saving up            dom dolla    3
2                rumble             skrillex   12
3            atmosphere               fisher   14
4            back on 74               jungle   17
5          eat your man            dom dolla   18
6               therapy             budjerah   19
7         sorry instead          spacey jane   20
8           be your man               g flip   22
9           take it off               fisher   23
10      rich baby daddy                drake   25
11                rough               g flip   26
12      dance the night             dua lipa   28
13    say yes to heaven         lana del rey   29
14    not strong enough            boygenius   30
15        get him back!       olivia rodrigo   34
16         baby again..           fred again   35
17   boy's a liar pt. 2       pinkpantheress   36
18             laced up        hilltop hoods   37
19         scary movies            the rions   40
20             pedestal        lime cordiale   42
21              popular           the weeknd   43
22           sweetheart            old mervs   47
23          padam padam        kylie minogue   48
24            australia               g flip   50
25                  ten           fred again   51
26     i used to be fun           teen jesus   52
27          lookin' out        king stingray   53
28   more than you know             blink182   54
29   all-american bitch       olivia rodrigo   56
30             darkside bring me the horizon   57
31                 lost bring me the horizon   58
32                  a&amp;w         lana del rey   60
33    fall at your feet           peking duk   64
34            real life               g flip   65
35    leaving the light        genesis owusu   69
36               snooze                  sza   70
37           speedracer         teenage dads   74
38       nobody gets me                  sza   75
39            sofa king           royel otis   76
40 i don't wanna be ...                 ruel   77
41                bleed        the kid laroi   78
42 video killed the ...         teenage dads   79
43               7 days               g flip   80
44     like a girl does            peach prc   81
45                 exes           tate mcrae   82
46        the summoning          sleep token   83
47     midnight driving         teenage dads   88
48            nightmare              polaris   90
49 did you know that...         lana del rey   91
50  strawberry daydream       pacific avenue   92
51          no bad days           the terrys   93
52   welcome to the dcc  nothing but thieves   95
53         stay blessed        genesis owusu   97
54        cool about it            boygenius   98
55           i miss you        slowly slowly   99</code></pre>
<p>With 55 snubs, we are going to have 55 surprise songs. There doesn’t seem to be a massive trend here. G flip only made it into my countdown twice, so 5 of their songs are in this list. Its also interesting seeing which conventionally popular songs are part of this list. Boy’s a liar pt.&nbsp;2 by Pinkpantheress and All American-Bitch which peaked at 2 and 10 on the aria charts were left out in my predictions, even though it predicted similar chart toppers in the top 10.</p>
<p><img src="post-2.markdown_strict_files/figure-markdown_strict/suroprise-comps-1.png" width="768"></p>
<p>Looking at these plots, it seems that the chart data for these songs didn’t correctly join with the play data from triple J. After cleaning the names, I was hoping that there wouldn’t be too much of a discrepancy. However, in the ARIA charts, “all-american bitch” is listed as “all-american b**ch,” and “boys a liar pt.&nbsp;2” is listed as “boys a liar”. This kind of discrepancy is probably present throughout my dataset and may have led to some major inaccuracies. However, it is also just part of life when dealing with text data.</p>
</section>
<section id="did-i-do-better-than-warm-tuna" class="level1">
<h1>Did I do better than Warm Tuna?</h1>
<p>Part of my mission when setting out to make these predictions was to outperform 100 Warm Tunas, who utilize a compilation of social media posts to formulate their predictions.</p>
<pre><code>                     Song         Artist rank warm_tuna my_rankning
1      paint the town red       doja cat    1         9           1
2  the worst person alive         g flip    2        11          55
3               saving up      dom dolla    3        18          NA
4              rhyme dust             mk    4         5          72
5                   prada           cass    5        19          90
6                 adore u     fred again    6         6          40
7    what was i made for?  billie eilish    7         4           3
8                    rush    troye sivan    8         1          10
9             lovin on me    jack harlow    9        49          17
10               chemical    post malone   10        28          14
11                vampire olivia rodrigo   11        14           2
12                 rumble       skrillex   12         3          NA
13              kill bill            sza   13        20           9
14             atmosphere         fisher   14        23          NA
15                 nanana      peggy gou   15        15           5
16               sprinter           dave   16        22           4
17             back on 74         jungle   17        13          NA
18           eat your man      dom dolla   18        59          NA
19                therapy       budjerah   19         8          NA
20          sorry instead    spacey jane   20        21          NA</code></pre>
<p>Straight away, I can see that warm tuna did better than me, but by how much?</p>
<p>So, I made up a quick statistic to see how far off our predictions were. This is the sum of the magnitudes of the differences between the predicted score and the actual score. If a song didn’t make the top 100, it’s given the equivalent rank of 101. I then divide this by 100 to get the average deviation for each prediction.</p>
<pre><code>my score: 36.28 

warm tuna's score: 26.5 </code></pre>
<p>So from these statistics, we can see that my predictions were, on average, about 10 places more off than warm tuna’s.</p>
</section>
<section id="next-year" class="level1">
<h1>Next Year?</h1>
<p>I reckon this method still has promise, but I need to sort out the name joining issue to ensure that my method is working at its maximum potential. I also want to include genre and artist country into it since it seemed to be an important factor in the final rank that I didn’t account for.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>